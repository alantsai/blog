Title: "[打造自己的template-建立一致性程式碼][10]用SideWaffle建立Project Template"
Published: 2017-09-09
Modified: 2017-09-09
Image: /posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb(33).png
Tags: ["visual studio","「打造自己的template-建立一致性程式碼」"]
RedirectFrom: 2017/09/buildYourOwnTemplate-use-sidewaffle-to-create-project-template.html
Series: ["「打造自己的template-建立一致性程式碼」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-Eq9thKeBhHE/WbP99k8_VuI/AAAAAAAAWTs/c8LVCqs6yj4AKbmRThYsaNvyOoMv-6wTgCHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="[10]用SideWaffle建立Project Template" style="display: inline; background-image: none;" alt="[10]用SideWaffle建立Project Template" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb(33).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/annual-report-book-brochure-686343/</figcaption></figure></section><section><p>  在上一篇（<a href="http://blog.alantsai.net/2017/09/buildYourOwnTemplate-VSIX-problem-SideWaffle-pros-intro.html">[09]內建VSIX的缺點 - SideWaffle基本介紹</a>）介紹完了內建VSIX template在維護上面的不方便和對於SideWaffle做了一個初步的介紹。   </p><p>  在這篇，將會使用SideWaffle來建立Project Template - 看看和內建的做法有何不同。   </p></section><section><div class="bs-callout bs-callout-default">匯出用的範例程式碼 <a href="https://github.com/alantsai-samples/mhat-visualstudio-template/releases/tag/sample%2Fchapter10">github mhat-visualstudio-template sample/chapter10</a></div></section><section><a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509933" ;="">SideWaffle建立Project Template</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509861" ;="">先安裝SideWaffle到VS 2015</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509494" ;="">建立一個VSIX專案</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509929" ;="">建立一個要變成template的project</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509267" ;="">用SideWaffle的功能建立關聯</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509779" ;="">微調設定</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509302" ;="">讓Project Template設定為不build</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509277" ;="">調整_project.vstemplate.xml的檔案</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509558" ;="">把_project.vstemplate.xml的檔案Wizard刪掉</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509573" ;="">測試</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509682" ;="">是否無法使用VS 2017來建立？</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509489" ;="">在project template的專案下面增加了檔案</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509130" ;="">修改了VSIX專案包含一個特殊的Reference到project template的專案</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509968" ;="">在VSIX專案安裝TemplateBuilder</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504967803509572" ;="">結語</a><br></li></ul></div></section> <a name="more"></a> <section><h2 id="WizKMOutline_1504967803509933">SideWaffle建立Project Template</h2><p>  在上一篇有提到說其實讓template變得好建立其實是透過套件<code>TemplateBuilder</code>，SideWaffle<em>不是</em>必須要被安裝。   </p><p>  不過有SideWaffle在建立上可以省一點事，所以在接下來這個demo，我們會先切換到Visual Studio（下面簡稱VS) 2015來做這個事情。   </p><p>  接下來的操作步驟如下：   </p><ol><li>先安裝SideWaffle到VS 2015</li><li>建立一個VSIX專案</li><li>建立一個要變成template的project</li><li>用SideWaffle的功能建立關聯</li><li>微調設定</li><li>測試</li></ol><section><h3 id="WizKMOutline_1504967803509861">先安裝SideWaffle到VS 2015</h3><p>   首先到VS的Marketplace，找到SideWaffle（<a href="https://marketplace.visualstudio.com/items?itemName=MadsKristensen.SideWaffleTemplatePack">下載鏈接</a>），然後安裝到VS 2015。    </p><p>   最後檢查一下，在<code>Tools</code> -&gt; <code>Extensions and Updates</code>裡面看看SideWaffle是否安裝成功。    </p><figure><a href="https://lh3.googleusercontent.com/-jhJ5mewnq40/WbP-ClevX7I/AAAAAAAAWT0/TAKdNCJrh0o5XbipD9Kmx4fKdXFkkI1bQCHMYCw/s1600-h/image%255B5%255D"><img width="654" height="310" title="SideWaffle安裝好" style="display: inline; background-image: none;" alt="SideWaffle安裝好" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[1](29).png" border="0" class="img-responsive"></a><br><figcaption>SideWaffle安裝好</figcaption></figure></section><section><h3 id="WizKMOutline_1504967803509494">建立一個VSIX專案</h3><p>   建立一個新的VSIX專案，這個會作為template安裝的VSIX檔案的來源。    </p><figure><a href="https://lh3.googleusercontent.com/-2AY0-lSNV48/WbP-IthUzkI/AAAAAAAAWT8/ZKDLam2cGVEQ0c3GmH6LLfN4DrKuBmvkwCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="200" title="建立出VSIX專案" style="display: inline; background-image: none;" alt="建立出VSIX專案" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[2](23).png" border="0" class="img-responsive"></a><br><figcaption>建立出VSIX專案</figcaption></figure></section><section><h3 id="WizKMOutline_1504967803509929">建立一個要變成template的project</h3><p>   在同一個Solution裡面，建立要變成Project Template的project。    </p><figure><a href="https://lh3.googleusercontent.com/-j8BKveCsmYQ/WbP-ONrv2RI/AAAAAAAAWUE/qVDI5yWE0M8DgZtLe9Zwr8x_MogfMex2gCHMYCw/s1600-h/image%255B11%255D"><img width="372" height="462" title="加入完之後Solution的內容" style="display: inline; background-image: none;" alt="加入完之後Solution的內容" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[3](20).png" border="0" class="img-responsive"></a><br><figcaption>加入完之後Solution的內容</figcaption></figure></section><section><h3 id="WizKMOutline_1504967803509267">用SideWaffle的功能建立關聯</h3><p>   對<em>VSIX專案</em>點<kbd>右鍵</kbd>選擇<code>Add</code> -&gt; <code>Add Template Reference (Sidewaffle Project)</code></p><figure><a href="https://lh3.googleusercontent.com/-k7ZqoNPUpSU/WbP-RmivkKI/AAAAAAAAWUM/II6gTDNWAqYTsqTrCWcp5O-RKDWWh0MigCHMYCw/s1600-h/image%255B14%255D"><img width="654" height="282" title="建立template reference" style="display: inline; background-image: none;" alt="建立template reference" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[4](20).png" border="0" class="img-responsive"></a><br><figcaption>建立template reference</figcaption></figure><p>   下拉選單會出現要變成template的project，確定好之後直接按下<kbd>ok</kbd></p><figure><a href="https://lh3.googleusercontent.com/-mq_yfyMSDuQ/WbP-a-9W81I/AAAAAAAAWUU/gxsJc8BY6KU-E5IeWcNZP3bta7doJo6PwCHMYCw/s1600-h/image%255B17%255D"><img width="590" height="284" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[5](13).png" border="0" class="img-responsive"></a><br><figcaption>選擇template的畫面</figcaption></figure><p>   這個時候VS會開始做一些動作，包括安裝<code>TemplateBuilder</code>，可以看VS的左下角知道他在做什麼。    </p><figure><a href="https://lh3.googleusercontent.com/-PWk_s-tFCZw/WbP-e0t7pEI/AAAAAAAAWUc/QVTbTXTU7UIxN7Fkw3qpiJYlEUkf_e5ygCHMYCw/s1600-h/image%255B20%255D"><img width="654" height="124" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[6](10).png" border="0" class="img-responsive"></a><br><figcaption>VS訊息</figcaption></figure><p>   完成之後，會開啟<code>_preprocess.xml</code>的檔案    </p><figure><a href="https://lh3.googleusercontent.com/-B-yHzQqXb4M/WbP-hZQU4BI/AAAAAAAAWUk/a1iGVy-iHAI0gD8gMmhoijZbm2bIJYvbACHMYCw/s1600-h/image%255B23%255D"><img width="654" height="175" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[7](7).png" border="0" class="img-responsive"></a><br><figcaption>最後完成畫面</figcaption></figure></section><section><h3 id="WizKMOutline_1504967803509779">微調設定</h3><p>   建立好之後，有兩個設定可以做一下調整：    </p><ol><li>讓Project Template設定為不build</li><li>調整_project.vstemplate.xml的檔案</li><li>把_project.vstemplate.xml的檔案Wizard刪掉</li></ol><section><h4 id="WizKMOutline_1504967803509302">讓Project Template設定為不build</h4><p>   因為另外一個project是我們的template，所以他其實不需要build，因此可以設定讓他不build，以減少每次的build時間。    </p><p>   在build configuration那邊可以把Template的build勾選掉。    </p><figure><a href="https://lh3.googleusercontent.com/-xonjUG893nQ/WbP-mTJg8eI/AAAAAAAAWUs/5aCAmWtfSxkAD7u8BRmdR5nL5bCodka8wCHMYCw/s1600-h/image%255B26%255D"><img width="654" height="187" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[8](8).png" border="0" class="img-responsive"></a><br></figure><figure><a href="https://lh3.googleusercontent.com/-qOXlZr6nk2Q/WbP-pnNA9xI/AAAAAAAAWU0/nIa4rqKrfeQmI0vDbP3COHZJ0_XIL7CJwCHMYCw/s1600-h/image%255B32%255D"><img width="654" height="478" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[10](2).png" border="0" class="img-responsive"></a><br><figcaption>勾選掉build，避免花時間</figcaption></figure></section><section><h4 id="WizKMOutline_1504967803509277">調整_project.vstemplate.xml的檔案</h4><p>    SideWaffle的這個功能其實有個bug，產生出來的<code>_project.vstemplate.xml</code>的檔案有bug，在裡面的<code>Project</code>element的<code>File</code>屬性是錯的，改成和project名稱一樣即可。     </p><figure><a href="https://lh3.googleusercontent.com/-kEVRA7Idllk/WbP-tR9JQhI/AAAAAAAAWU8/wCLeSMOvPNcgd86G1Jff0g8pEDnOPqwagCHMYCw/s1600-h/image%255B35%255D"><img width="654" height="130" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[11](3).png" border="0" class="img-responsive"></a><br><figcaption>修正錯誤的地方</figcaption></figure></section><section><h4 id="WizKMOutline_1504967803509558">把_project.vstemplate.xml的檔案Wizard刪掉</h4><p>    還有一個地方也應該拿掉，在<code>_project.vstemplate.xml</code>裡面<code>WizardExtension</code>可以直接拿掉。     </p><p>    那個是SideWaffle template用來記錄template下載次數，但是一般不要整合到SideWaffle的template不需要     </p><figure><a href="https://lh3.googleusercontent.com/-IQV0Q39K014/WbP-wJVQA_I/AAAAAAAAWVE/fJtYT1hsIdwNbehPfYhkvl5LZHBObQXPQCHMYCw/s1600-h/image%255B38%255D"><img width="654" height="298" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[12](4).png" border="0" class="img-responsive"></a><br><figcaption>拿掉的部分</figcaption></figure></section></section><section><h3 id="WizKMOutline_1504967803509573">測試</h3><p>   做好了之後，可以直接run起來，然後預設在分類<code>C#</code> -&gt; <code>Web</code> -&gt; <code>SideWaffle</code>裡面。    </p><figure><a href="https://lh3.googleusercontent.com/-g6wSlGOpWo0/WbP-0Eh9QUI/AAAAAAAAWVM/bHh--lpzKGc7qvvqDgNiHLE-JcWeUKiBQCHMYCw/s1600-h/image%255B41%255D"><img width="654" height="375" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-09-buildYourOwnTemplate-use-sidewaffle-to-create-project-template_Asset/image_thumb[13](4).png" border="0" class="img-responsive"></a><br><figcaption>測試template</figcaption></figure><p>   這個時候，假設我們要調整範本，可以直接在<code>MHAT.ConsoleWithOption</code>這個專案裡面直接加入，<em>不需要</em>在做任何事情，新的修改都會包含在建立出來的template裡面。    </p></section></section><section><h2 id="WizKMOutline_1504967803509682">是否無法使用VS 2017來建立？</h2><p>  基本上做完上面的流程，用SideWaffle建立Project Template的方式就完成了。   </p><p>  接下來只要對Template專案做任何修改，只要在run就會包含修改內容，不需要額外做任何處理。   </p><p>  但是畢竟目前官方SideWaffle只有支援VS 2015，是否2017就無法做到一樣效果？   </p><p>  其實不然，如果分析一下，就可以發現<code>Add Template Reference</code>在做什麼，基本上修改/新增一些檔案：   </p><ol><li>在project template的專案下面增加了檔案</li><li>修改了VSIX專案包含一個特殊的Reference到project template的專案</li><li>在VSIX專案安裝TemplateBuilder</li></ol><div class="bs-callout bs-callout-default"><p>   詳細每一個檔案調整什麼可以參考commit：<a href="https://github.com/alantsai-samples/mhat-visualstudio-template/commit/06cfaaba0b5193cf107ff93b5d76c792d681a681">用SideWaffle的Add Template Reference完</a></p></div><section><h3 id="WizKMOutline_1504967803509489">在project template的專案下面增加了檔案</h3><p>   總共增加了幾個檔案：    </p><ul><li>\_Definitions\_project.vstemplate.xml</li><li>\_preprocess.xml</li><li>\sw-file-icon.png</li></ul></section><section><h3 id="WizKMOutline_1504967803509130">修改了VSIX專案包含一個特殊的Reference到project template的專案</h3><p>   在<code>SideWaffle.csproj</code>（VSIX專案的csproj）加入一個Item Group    </p><pre class="brush: xml;"><code class="language-markup line-numbers">&lt;ItemGroup&gt;
 &lt;TemplateReference Include="MHAT.ConsoleWithOption.csproj"&gt;
   &lt;PathToProject&gt;../MHAT.ConsoleWithOption/MHAT.ConsoleWithOption.csproj&lt;/PathToProject&gt;
 &lt;/TemplateReference&gt;
&lt;/ItemGroup&gt;</code></pre></section><section><h3 id="WizKMOutline_1504967803509968">在VSIX專案安裝TemplateBuilder</h3><p>   這個就同等於用nuget安裝<code>TemplateBuilder</code>一樣。    </p></section><p>  所以其實完全可以用VS 2017建立，然後做上面幾個動作來達到一樣的效果。   </p></section><section><h2 id="WizKMOutline_1504967803509572">結語</h2><p>  在這篇介紹了如何用VS 2015搭配SideWaffle套件來建立一個Project Template。   </p><p>  這種方式建立出來的Project Template有個很強的優勢 - 未來要改template內容，只要用像一般VS開發專案那樣調整project template專案就好。   </p><p>  也分析了到底SideWaffle的動作加了什麼，了解背後原理之後，其實VS 2017也可以做到一樣效果，只是需要手動處理比較麻煩。   </p><p>  不過這些檔案的意義和如何微調SideWaffle將會是下一篇的重點。   </p></section> <section> <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:5b9471c2-d94f-4073-b65c-193f3e058a72" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c%e6%89%93%e9%80%a0%e8%87%aa%e5%b7%b1%e7%9a%84template-%e5%bb%ba%e7%ab%8b%e4%b8%80%e8%87%b4%e6%80%a7%e7%a8%8b%e5%bc%8f%e7%a2%bc%e3%80%8d" rel="tag">「打造自己的template-建立一致性程式碼」</a>,<a href="/tags/Visual+Studio" rel="tag">Visual Studio</a></div></section>