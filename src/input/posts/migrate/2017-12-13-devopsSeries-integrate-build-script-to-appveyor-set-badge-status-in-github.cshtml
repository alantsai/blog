Title: "[從.Net工程師的角度來看DevOps 23]在AppVeyor執行Build Script - 整合build資訊到github"
Published: 2017-12-13
Modified: 2017-12-13
Image: /posts/migrate/2017-12-13-devopsSeries-integrate-build-script-to-appveyor-set-badge-status-in-github_Asset/image_thumb(57).png
Tags: [".net","「ithome 第八屆鐵人賽」","devops","「從.net工程師的角度來看devops」","psake","powershell"]
RedirectFrom: 2017/12/devopsSeries-integrate-build-script-to-appveyor-set-badge-status-in-github.html
Series: ["「iThome 第八屆鐵人賽」","「從.Net工程師的角度來看DevOps」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-BFTeq-4VvVk/WjBp3vNt4WI/AAAAAAAAXE8/Qdz4poPd07Ewc2mlfbR7J-c3S64LWrNtQCHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-13-devopsSeries-integrate-build-script-to-appveyor-set-badge-status-in-github_Asset/image_thumb(57).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/books-spine-colors-pastel-1099067/ 和 https://blog.xebialabs.com/2016/03/21/essential-devops-terms/</figcaption><br></figure></section><section></section><section></section><section><p>  在上一篇（<a href="http://blog.alantsai.net/2017/12/devopsSeries-ci-server-appveyor-intro.html" target="_blank" rel="noopener">[從.Net工程師的角度來看DevOps 22]免費的CI Server - AppVeyor介紹</a><span style="line-height: 1.6;">）了解到了如何把專案關聯到AppVeyor裡面，然後可以很簡單利用AppVeyor裡面內建的一些設定來build專案。</span></p><p>  在這篇，我們將完全拋棄AppVeyor的內建機制，改成用我們建立出來的build script來執行。   </p><p>  有自己的build script不止在設定上變得更簡單，local跑的和CI Server跑的會一樣，並且如果要整合到另外一個CI Server也不會有什麼問題。   </p></section><div class="bs-callout bs-callout-default">  sample 程式在 <a href="https://github.com/alantsai-samples/devops-psake/releases/tag/sample%2Fchapter23">github devops-psake sample/chapter23</a></div><section><a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6;" href="#WizKMOutline_1513121856654609" ;="">調整AppVeyor來執行build script</a><br></li><li><a style="line-height: 1.6;" href="#WizKMOutline_1513121856655592" ;="">查看執行結果</a><br></li><li><a style="line-height: 1.6;" href="#WizKMOutline_1513121856655437" ;="">結語</a><br></li></ul></div></section><a name="more"></a><section><h2 id="WizKMOutline_1513121856654609">調整AppVeyor來執行build script</h2><p>  任何CI Server基本上都會有地方讓我們關掉內建的執行方式，改成直接執行我們指定的檔案，AppVeyor當然也不例外。做法很簡單，首先：   </p><ol><li>切換到<code>Settings</code></li><li>然後左邊menu的<code>build</code></li><li>上面的部分直切換到<code>SCRIPT</code></li><li>選擇<code>PS</code>代表powershell</li><li>內容輸入框指向build script的位置： <kbd>src\BuildProject\build.ps1</kbd></li><li>最後保存修改</li></ol><figure><a href="https://lh3.googleusercontent.com/-LaUgTn2eMb8/WjBp60oFgNI/AAAAAAAAXFE/Ki-z6xqTTRIG1uB9meqYHIw-7PT6QjTrgCHMYCw/s1600-h/image%255B5%255D"><img width="654" height="289" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-13-devopsSeries-integrate-build-script-to-appveyor-set-badge-status-in-github_Asset/image_thumb[1](51).png" border="0" class="img-responsive"></a><br><figcaption>修改build的畫面</figcaption></figure><p>  再來他內建會自動去找Test相關的dll並且做執行。由於我們的build script<em>已經會做Test</em>，因此可以直接把內建機制<em>關掉</em>節省時間：   </p><ol><li>切換左邊menu的<code>TEST</code></li><li>設定改成<code>off</code>表示不要跑</li><li>最後儲存</li></ol><figure><a href="https://lh3.googleusercontent.com/-e-UqSDRjZx8/WjBp9B0M_0I/AAAAAAAAXFM/HQiqGVnQsFcaI3zHmtgUKsDF79u2WZL6ACHMYCw/s1600-h/image%255B8%255D"><img width="654" height="313" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-13-devopsSeries-integrate-build-script-to-appveyor-set-badge-status-in-github_Asset/image_thumb[2](41).png" border="0" class="img-responsive"></a><br><figcaption>把Test關掉</figcaption></figure></section><section><h2 id="WizKMOutline_1513121856655592">查看執行結果</h2><p>  上面設定好了之後，就可以切回到<code>LATEST BUILD</code>的畫面去手動觸發我們的build：   </p><figure><a href="https://lh3.googleusercontent.com/-UAA4ClL8zLA/WjBqAU1l2zI/AAAAAAAAXFU/AWS-wwAuQlEl3hCALAZCgl5Rj3DhfJgWgCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="470" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-13-devopsSeries-integrate-build-script-to-appveyor-set-badge-status-in-github_Asset/image_thumb[3](38).png" border="0" class="img-responsive"></a><br><figcaption>build結果，可以看到和我們localbuild的output內容一樣</figcaption></figure><div class="bs-callout bs-callout-info">   由於我們是public專案，所以可以直接看到我們的build log：<a href="https://ci.appveyor.com/project/alantsai/devops-psake/build/1.0.4">https://ci.appveyor.com/project/alantsai/devops-psake/build/1.0.4</a></div><p>  設定好了之後，如果能夠一目了然在專案上面看到目前build情況會很好，因此，我們可以設定一個Badge（徽章）放在我們repo的readme裡面。設定方式就是：   </p><ol><li>左邊menu切換到<code>Badges</code></li><li>找到要顯示的那段，並且貼到<code>ReadMe.md</code></li><li>push了之後github就會看到</li></ol><figure><a href="https://lh3.googleusercontent.com/-K_l8Vdfx9K8/WjBqEqzktHI/AAAAAAAAXFc/jNCL5BxhSAQz0LMTmy-afgUTr5fk1D6cwCHMYCw/s1600-h/image%255B14%255D"><img width="654" height="477" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-13-devopsSeries-integrate-build-script-to-appveyor-set-badge-status-in-github_Asset/image_thumb[4](38).png" border="0" class="img-responsive"></a><br><figcaption>取得badge，放到readme在github看到</figcaption></figure><div class="bs-callout bs-callout-info">   這邊會注意到一件事情，當我把放badge的commit push到git了之後，AppVeyor會透過WebHook自動觸發。換句話說，每一個push就會build一次。這就是Continus Integration。   </div></section><section><h2 id="WizKMOutline_1513121856655437">結語</h2><p>  透過這篇希望對於為什麼建立自己的Build Script更加有感，雖然CI Server上面設定很方便，但是透過我們build script執行也很方便（只是建立比較麻煩），並且local執行起來的樣子和CI Server執行的一樣。   </p><p>  再來看到了如何整合我們的build狀況到Github，並且AppVeyor會自動在我們push的時候執行build，形成了Continus Integration（CI）   </p><p>  在下篇，我們將會看另外一個免費的CI Server，Visual Studio Team Service（VSTS），並且了解一下和AppVeyor的差異和內建VSTS提供的build方法。   </p></section><section>   <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:8e11b467-24b1-4b13-85ab-69694d7469a6" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c%e5%be%9e.Net%e5%b7%a5%e7%a8%8b%e5%b8%ab%e7%9a%84%e8%a7%92%e5%ba%a6%e4%be%86%e7%9c%8bDevOps%e3%80%8d" rel="tag">「從.Net工程師的角度來看DevOps」</a>,<a href="/tags/%e3%80%8ciThome+%e7%ac%ac%e5%85%ab%e5%b1%86%e9%90%b5%e4%ba%ba%e8%b3%bd%e3%80%8d" rel="tag">「iThome 第八屆鐵人賽」</a>,<a href="/tags/devops" rel="tag">devops</a>,<a href="/tags/.net" rel="tag">.net</a></div></section>