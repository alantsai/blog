Title: "[iis]每個Server都應該做的資安防護 - 使用IIS Crypto一鍵設定該啟用和停用的SChannel (如SSL 3.0)和Cipher Suite (如MD5)"
Published: 2017-09-20
Modified: 2017-12-01
Image: /posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb[6](14).png
Tags: ["best practices","security","tool","iis"]
RedirectFrom: 2017/09/iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto.html
Series: []
---
<section><figure><a href="https://lh3.googleusercontent.com/-BPjsHhNdiB8/WcKALDvpzCI/AAAAAAAAWbw/SpcwJAnHz4Mdvt1xZ-GyKE4_bPBJPkOAQCHMYCw/s1600-h/image%255B20%255D"><img width="654" height="290" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb[6](14).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/key-tag-security-label-symbol-2114047/</figcaption></figure></section> <section>   <p>  資安是最需要注意也最容易忽視掉的一環，尤其是當有些資安是和系統設定有關的時候。   </p><p>  作為開發人員，程式開發上面的資安注意事項是一定要知道的，但是Server上面就不一定，但是有時候會需要開發者來管理Server，這時候知道一些Server資安要注意的設定就變得非常重要。   </p><p>  在這一篇將會提到一個Server常被忽視的地方，就是設定IIS https裡面可以使用的SChannel和Cipher Suite。如何透過IIS Crypto設定最佳建議的設定。   </p><div class="bs-callout bs-callout-default"><h4 kmcontenthide="1">相關文章</h4><ul><li>2017-11-30 - <a href="http://blog.alantsai.net/2017/11/iis-why-online-test-still-show-disabled-cipher-suite-use-TestSSLServer-for-local-cipher-suite-test.html" target="_blank">[iis]為什麼ssl cipher suite關閉了檢查還是有出現問題 - 如何local檢查ssl和cipher suite</a></li></ul></div></section>   <section> <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><ul style="margin: 0px 0px 0px 30px;"><li><a href="#WizKMOutline_1505917717844864" ;="">https的資安問題 - SSL 3.0為例</a></li><li><a href="#WizKMOutline_1505917717844346" ;="">IIS Crypto介紹</a></li><ul style="margin: 0px 0px 0px 30px;"><li><a href="#WizKMOutline_1505917717844894" ;="">SChannel 的設定</a></li><li><a href="#WizKMOutline_1505917717844647" ;="">Cipher Suite 設定</a></li><li><a href="#WizKMOutline_1505917717844264" ;="">Site Scanner</a></li></ul><li><a href="#WizKMOutline_1505917717844224" ;="">結語</a></li></ul></ul></div></section>     <a name="more"></a>     <section><h2 id="WizKMOutline_1505917717844864">https的資安問題 - SSL 3.0為例</h2><p>  資安是一個持續性的議題，很多以前認為安全的東西，在幾年之後就可能會被攻破。   </p><p>  以https為例，幾年前就有宣佈SSL 3.0可能會受到<code>貴賓犬</code>攻擊（<a href="http://www.ithome.com.tw/news/91571">Google 發現 SSL 3.0 漏洞，小心「貴賓犬」攻擊！</a>），因此我們的server要關掉SSL 3.0的   SChannel才對。   </p><p>  要做到這個事情，有幾個麻煩/困難點：   </p><ul><li>要關掉SSL 3.0只能夠透過<code>regedit（登錄檔）</code>，換句話說內建沒有簡單方式能夠做到，只能完全了regedit的路徑並且設定。</li><li>另外一個問題是，那些應該要關掉對開發者來說其實<em>並不知道</em>，所以可能會需要花很多時間找資料才能夠完全關掉不安全的SChannel。</li></ul><p>  因此，誕生了一個軟體<code>IIS Crypto</code>，能夠幫我們快速關掉一些SChannel和Cipher   </p></section><section><h2 id="WizKMOutline_1505917717844346">IIS Crypto介紹</h2><div class="bs-callout bs-callout-info"><br><dl><dt>      軟體名稱     </dt><dd>      IIS Crypto     </dd><dd></dd><dt>      下載鏈接     </dt><dd><a href="https://www.nartac.com/Products/IISCrypto/Download">https://www.nartac.com/Products/IISCrypto/Download</a></dd><dd></dd><dt>      特色     </dt><dd><ul><li>免費軟體</li><li>一鍵關閉不安全的SChannel</li><li>一鍵關閉不安全的Cipher Suite</li><li>快速檢查網站https安全程度</li></ul></dd><dd></dd></dl></div><p>  基本上使用IIS Crypto非常簡單，只需要run起來然後使用<code>Best Practise</code>然後選擇<code>Apply</code>即可。接下來會針對每個部分看一下實際操作。   </p><section><h3 id="WizKMOutline_1505917717844894">SChannel 的設定</h3><p>   打開軟體之後第一個看到的就是<code>SChannel</code>的設定。    </p><figure><a href="https://lh3.googleusercontent.com/-sByG97PefRE/WcKAOPtflLI/AAAAAAAAWb4/CVvxYxnPWf482SMQjqHzwaYbvAwAHjvdQCHMYCw/s1600-h/image%255B2%255D"><img width="654" height="513" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb(38).png" border="0" class="img-responsive"></a><br><figcaption>剛開啟的畫面</figcaption></figure><p>   預設都是<em>灰色</em>表示沒有做過任何設定。這個時候可以透過勾選的方式來選擇那些要開啟和那些要關閉。    </p><p>   不過一般非資安人員不會知道那些應該勾而那些不應該，所以這個時候可以使用建議的設定，在左下角有個<code>Best Practise</code>的按鈕，點下去之後，會自動勾選要的（安全的）和不勾選（不安全的）設定。    </p><p>   這個時候要在點下右邊的<code>Apply</code>才會真的做修改。    </p><figure><a href="https://lh3.googleusercontent.com/-hEDhzMzmJ5A/WcKAQNqyu1I/AAAAAAAAWcA/6IqtJSp1CQkfWbEwFrKCQ-e7IVaKKIr1ACHMYCw/s1600-h/image%255B5%255D"><img width="654" height="513" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb[1](33).png" border="0" class="img-responsive"></a><br><figcaption>使用最建議的設定方式</figcaption></figure></section><section><h3 id="WizKMOutline_1505917717844647">Cipher Suite 設定</h3><p>   和SChannel設定一樣，進去的時候會有一堆清單，用勾選來表示那些要包含，取消勾選來不包含。    </p><p>   如果不知道設定什麼，一樣用最佳設定就好，選擇<code>Best Practise</code>，然後選擇<code>Apply</code></p><figure><a href="https://lh3.googleusercontent.com/-cA2aaI-nICI/WcKAVAWgsAI/AAAAAAAAWcI/CqtvvsEQqBAwU5xvg3Z9qRX6U20HfruJQCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="513" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb[2](27).png" border="0" class="img-responsive"></a><br><figcaption>使用Best Practise的設定</figcaption></figure></section><section><h3 id="WizKMOutline_1505917717844264">Site Scanner</h3><p>   當設定好https之後，最好驗證一下有沒有什麼問題，這個時候可以切換到左邊<code>第四個</code>頁簽：<code>Site Scanner</code>，把要檢測的網址輸入進去，然後按下<code>scan</code>。    </p><figure><a href="https://lh3.googleusercontent.com/-jn4zubrGSIc/WcKAZBDhNHI/AAAAAAAAWcQ/LDKfQbmGC_Uhr3qCUhw3ekkXT9F5mnEagCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="324" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb[3](24).png" border="0" class="img-responsive"></a><br><figcaption>以google為範例</figcaption></figure><p>   會自動開啟瀏覽器，然後直接帶到<code>Qualys SSL Labs</code>的檢測結果，會幫ssl憑證打分，並且建議那些地方可以做調整（如果資安不安全的話）。    </p><figure><a href="https://lh3.googleusercontent.com/-1mn_mBzzHSc/WcKAdNmpcZI/AAAAAAAAWcY/uZ-cTh8hpWIavSQ7gEi3aLhynV_OZBrJACHMYCw/s1600-h/image%255B14%255D"><img width="654" height="282" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb[4](23).png" border="0" class="img-responsive"></a><br><figcaption>以google為例評分為A</figcaption></figure><p>   可以點進去看：    </p><figure><a href="https://lh3.googleusercontent.com/-j6561Sd_2NE/WcKAhwuTzMI/AAAAAAAAWcg/kVk0MwMEyo0fL_Me9Btct3QiuOd_rXPtgCHMYCw/s1600-h/image%255B17%255D"><img width="654" height="338" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-09-20-iis-security-set-correct-schannel-and-cipher-suite-using-iis-crypto_Asset/image_thumb[5](17).png" border="0" class="img-responsive"></a><br><figcaption>以這邊為例可以看到建議Cipher Suites裡面<code>TLS_RSA_WITH_3DES_EDE_CBC_SHA (0xa) </code>屬於弱</figcaption></figure><p>   所以這個Site Scanner可以再做一個二次確認，確保設定有啟用成功。    </p></section></section><section><h2 id="WizKMOutline_1505917717844224">結語</h2><p>  IIS Crypto是一個人人都應該要有的軟體，並且每一台Windows Server都應該要執行並且設定以避免一些不安全的cipher和SChannel被使用。   </p><p>  這個軟體最棒的地方是，就算你不清楚那些有問題，他已經幫你定義好一些最佳建議，因此只要設定就好，再也不用使用<code>regedit</code>然後打錯字導致設定錯誤。   </p></section> <section> <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:d759a044-4ccf-4e45-a08e-774c6b7b2755" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/iis" rel="tag">iis</a>,<a href="/tags/best+practices" rel="tag">best practices</a>,<a href="/tags/security" rel="tag">security</a></div></section>