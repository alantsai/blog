Title: "[Data Science 到底是什麼從一個完全外行角度來看][16]用R來看股票，透過quantmod了解R的強大"
Published: 2018-01-03
Modified: 2018-01-16
Image: /posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb(75).png
Tags: ["data processing","「data science 到底是什麼從一個完全外行角度來看」","r","data science"]
RedirectFrom: 2018/01/data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod.html
Series: ["「Data Science 到底是什麼從一個完全外行角度來看」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-FkUx_u1iq7c/WkzwNVKKgOI/AAAAAAAAXdg/53UnARig8SUClzk20A6EKh8hzR05zqHPACHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb(75).png" border="0" class="img-responsive"></a><br><figcaption><span>圖片來源：         <a href="https://pixabay.com/en/books-spine-colors-pastel-1099067/">https://pixabay.com/en/books-spine-colors-pastel-1099067/</a> 和         <a href="https://pixabay.com/en/math-blackboard-education-classroom-1547018/">https://pixabay.com/en/math-blackboard-education-classroom-1547018/</a></span></figcaption></figure></section><section><p>在上篇(<a href="http://blog.alantsai.net/2018/01/data-science-series-15-r-history-rstudio-r-tools-for-studio-ide-setting.html">[15]R是什麼？準備開發R的環境 - RStudio介紹</a>)了解了R的歷史和準備好了接下來的開發環境之後，就可以開始用R來做分析了。</p><p>一般來說，在學新的語言都會先看看所謂的Hello World，了解整個語言的Syntax和感覺。             </p><p>不過R不是一般型的程式語言，是給統計學家用的語言。因此，個人覺得如果只是看Hello World好像看不出來R特別的地方，不過如果直接學語法又太無聊。             </p><p>因此，這邊透過安裝和使用<code>quantmod</code>這個套件，並且用它來簡單分析股票作為R的入門介紹。             </p><div class="bs-callout bs-callout-default">這篇的範例程式碼在github：<a href="https://github.com/alantsai/blog-data-science-series/tree/master/src/chapter-16-r-quantmod-intro">alantsai/blog-data-science-series 裡面的 src/chapter-16-r-quantmod-intro</a></div></section>                          <section> <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190931779" ;="">quantmod是什麼？</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190931461" ;="">用quantmod分析google股票</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190931154" ;="">安裝和載入quantmod套件</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190932435" ;="">取得google股票資訊和分析得出內容</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190932200" ;="">畫出走勢</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190932414" ;="">畫出黃金和死亡交叉線</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190932384" ;="">結語</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1514991190932227" ;="">參考資料</a><br></li></ul></div></section>              <a name="more"></a>              <section><h2 id="WizKMOutline_1514991190931779">quantmod是什麼？</h2><p>quantmod是一個R的套件，全稱是<code>Quantitative Financial Modelling and Trading Framework for R </code>，它是一個套件用來做股票相關分析。             </p><p>接下來將會用quantmod來分析google的股票。             </p></section><section><h2 id="WizKMOutline_1514991190931461">用quantmod分析google股票</h2><p>接下來會分幾個階段進行：                 </p><ol><li>安裝和載入quantmod套件</li><li>取得google股票資訊和分析得出內容</li><li>畫出走勢</li><li>畫出黃金和死亡交叉線</li></ol><section><h3 id="WizKMOutline_1514991190931154">安裝和載入quantmod套件</h3><p>第一個指令是：<code>library("quantmod")</code></p><p>可以直接放在左上角的script裡面，或者左下角的console執行。</p><p>在之後只要看到R的script裡面有出現：<code>library</code>，或者<code>require</code>，表示要<em><strong>載入套件到目前的session</strong></em>。                 </p><p>舉例來說，如果看到<code>library("quantmod")</code>表示需要套件<code>quantmod</code>，這個時候如果沒有這個套件就<em><strong>記得要安裝</strong></em>。                 </p><p>安裝方式有兩種：                     </p><ol><li>透過指令 - <code>install.packages</code></li><li>透過gui</li></ol><div class="bs-callout bs-callout-info">嚴格來說只有一種方式，就是<em>指令</em>，因為gui其實也是呼叫指令。                     </div><p>使用GUI的話，有幾種做法：                     </p><ol><li>選擇右下角的 <code>install</code></li><li>在package名稱輸入 <code>quantmod</code> - 這邊會注意到會有auto complete的效果</li><li>最後按下安裝</li></ol><figure><a href="https://lh3.googleusercontent.com/-JreV_R0ucfA/WkzwQRC0fKI/AAAAAAAAXdo/Qn9eE6LAcrQNrlxE_NBaHupDyev_EyEvwCHMYCw/s1600-h/image%255B5%255D"><img width="563" height="407" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb[1](63).png" border="0" class="img-responsive"></a><br><figcaption>用gui安裝package</figcaption></figure><p>實際上，這個動作同等於在console呼叫<code>install.packages("quantmod")</code>，這邊有件事情要注意一下，安裝的時候會出現<em>紅色的字</em>，那個不是錯誤，只是在這個theme的情形下的訊息。                     </p><figure><a href="https://lh3.googleusercontent.com/-_G7BFr-RCLs/WkzwSxlnbKI/AAAAAAAAXdw/WxHMKtlY6IIc271OM5-o8XhSSccWF8HwQCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="590" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb[2](51).png" border="0" class="img-responsive"></a><br><figcaption>安裝的畫面</figcaption></figure></section><section><h3 id="WizKMOutline_1514991190932435">取得google股票資訊和分析得出內容</h3><p>在這個部分的指令如下：                     </p><pre class="brush: plain;"><code class="language-none line-numbers"># 取得google的股票，並且看看前6筆資料
getSymbols("GOOG")
head(GOOG)
                    </code></pre><p>這邊用了兩個指令：                     </p><dl><dt>getSymbols</dt><dd>這個是quantmod提供的方法，GOOG是google的股票代號，這個資料是從yahoo股市來。</dd><dt>head</dt><dd><p>這個是r base（核心）的方法，表示看前6筆的資料。                             </p><p>這個會很常看到，當拿到Data不知道是什麼的時候，就會呼叫<code>head</code>看一下內容。                             </p></dd></dl><figure><a href="https://lh3.googleusercontent.com/-dunUOztkerk/WkzwUuItX_I/AAAAAAAAXd4/l92EVlMLwxcyL4vuAwcH37T5OV5MzW5DgCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="450" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb[3](49).png" border="0" class="img-responsive"></a><br><figcaption>執行結果</figcaption></figure><p>head出來的結果看到有6個欄位：                     </p><ol><li>GOOG.Open - 就是開盤價</li><li>GOOG.High - 最高價</li><li>GOOG.Low - 最低價</li><li>GOOG.Close - 收盤價</li><li>GOOG.Volime - 成交量</li><li>GOOG.Adjusted - 還原權值</li></ol><p>每一列是一個日期，換句話說就是每一天。                     </p><div class="bs-callout bs-callout-info">還記得之前提到Data Science的3個圈圈嗎？其中一塊就是Domain Knowledge。如果不懂股票，那麼剛剛那些數值其實沒有任何意義。                     接下來也沒有辦法做分析。                 </div></section><section><h3 id="WizKMOutline_1514991190932200">畫出走勢</h3><p>看股票的就知道，會看一個所謂的走勢圖，quantmod讓畫這個走勢圖非常的簡單，只需要呼叫：<code>chartSeries(GOOG)</code></p><figure><a href="https://lh3.googleusercontent.com/-xcoaS_GPiE4/WkzwXSfQlWI/AAAAAAAAXeA/BfJO4GoWVykX8pntSB1pXfcyybpnKycugCHMYCw/s1600-h/image%255B14%255D"><img width="654" height="349" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb[4](50).png" border="0" class="img-responsive"></a><br><figcaption>畫出走勢圖，從20070103到20180102</figcaption></figure>                     可以把這張圖放大（放大鏡 Zoom）或者另存（圖片Export）                 <p>這個的區間可能非常長，可能看不太清楚，因此可以限制變成只分析進3個月的資料：                     <code>chartSeries(GOOG["2017-11-03::2018-01-03",])</code></p><div class="bs-callout bs-callout-info">還記得整個資料像是一個table的樣子，那麼等於我們在限制row（列）的部分，因為每一列是日期。                 </div><figure><a href="https://lh3.googleusercontent.com/-1jKWL8aJx0s/Wkzwap-JiGI/AAAAAAAAXeI/ra99BjCqM30Ta821CaAlXe9mbayWQd9hwCHMYCw/s1600-h/image%255B17%255D"><img width="654" height="344" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb[5](35).png" border="0" class="img-responsive"></a><br><figcaption>只顯示3個月</figcaption></figure><div class="bs-callout bs-callout-info">這個是國外的軟體，所以<em>綠色代表漲</em>，<em>紅色代表跌</em>。又是另外一個Domain Knowledge。                 </div></section><section><h3 id="WizKMOutline_1514991190932414">畫出黃金和死亡交叉線</h3><p>有了資料和走勢，接下來是做一些分析。                 </p><p>在股票來說，有個所謂的<em>黃金交叉新</em>和<em>死亡交叉線</em>。                 </p><p>基本上有個概念叫做移動平均數（Moving Average MA），例如如果計算3天均數就是把三天的價加總算出平均。那這個會隨著天數移動，因此叫做移動平均數。                 </p><p>如果一個長期的MA（例如60日季線）屬於<em>下降</em>然後短期的MA（例如20日月線）屬於<em>上升</em>並且<em>交叉</em>，就稱之為<em>黃金交叉</em>，原因是整個趨勢屬於上漲。                 </p><p>死亡交叉是一樣概念，只是反過來。<em>短期</em>的MA屬於<em>下降</em>，然後<em>長期</em>屬於<em>上升</em>，兩者交叉的時候就是<em>死亡交叉</em>。                 </p><div class="bs-callout bs-callout-info">還是要強調，Domain Knowledge的重要，小弟我不懂股票，了解這個概念也是花了一點時間。                 </div><p>有了這個概念之後，來執行以下語法：                 </p><pre class="brush: plain;"><code class="language-none line-numbers"># 計算 20日和60日均線
ma20&lt;-runMean(GOOG[,4],n=20)
ma60&lt;-runMean(GOOG[,4],n=60)
head(ma20, 25)

# 畫上線
chartSeries(GOOG["2017-01-03::2018-01-03",], theme = "white")
addTA(ma20,on=1,col="blue")
addTA(ma60,on=1,col="red")</code></pre><p>這邊用了一個新的方法，但是大部分都是quantmod的方法，因此不介紹了，不過有三個地方做一下說明：     </p><dl><dt>runMean(GOOG[,4], n=20)</dt><dd><p>重點在<code>GOOG[,4]</code>。                 </p><p>這邊有兩個部分：                     </p><ol><li>還記得MA的計算是用收盤價，所以我們要用所有的資料，因此逗點前面是空白，剛好和剛剛過濾日期是顛倒</li><li>這邊用的是第四個欄位，也就是收盤價的欄位。R裡面的index是從<em>1</em>開始，而不是像一般從0開始</li></ol></dd><dt>指令：<code>head(ma20,25)</code></dt><dd> 這邊指的是看前25筆，由於是20日均線，所以前20筆是NA因為不夠計算。         </dd><dt>指令：<code>chartSeries(GOOG["2017-01-03::2018-01-03",], theme = "white")</code></dt><dd>             之前只顯示前3個月沒辦法很好的畫，所以把整個時間拉長到1年，並且改成白色比較方便畫線。         </dd></dl><figure><a href="https://lh3.googleusercontent.com/-bliu2-M0frc/WkzwcqYQ4rI/AAAAAAAAXeQ/k-QqW9Z2AbMubMsGlzG22QhPNzPQHmljACHMYCw/s1600-h/image%255B20%255D"><img width="654" height="349" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2018-01-03-data-science-series-16-r-hello-world-with-stock-analysis-using-quantmod_Asset/image_thumb[6](34).png" border="0" class="img-responsive"></a><br><figcaption>畫上均線</figcaption></figure></section></section><section><h2 id="WizKMOutline_1514991190932384">結語</h2><p>希望透過透過這個範例可以看出R的一些特點：不管在過濾列的資料和欄的資料都可以用簡單array的感覺來做到，並且在繪圖上面和呈現非常方便。             </p><p>不過要注意的是，這邊很多指令都是和quantmod這個套件有關，因此在一般其他的Exploratory analysis比較沒辦法使用到。             </p><p>因此在接下來將會在下一篇(<a href="http://blog.alantsai.net/2018/01/data-science-series-17-r-program-basic-language-paradigm-and-data-type.html">[17]R語言基礎 上篇 - 語言特性和資料形態</a>)介紹R的特性，和其他語言差別在哪別和一些特色。             </p></section><section><h2 id="WizKMOutline_1514991190932227">參考資料</h2><dl><dt>quantmod官網</dt><dd><a href="http://www.quantmod.com/examples/intro/#data">官網資料使用範例</a></dd><dt>第一次使用R語言做回測：六分鐘，就上手! </dt><dd><p>這篇基本參考了這個部落格裡面內容做介紹，部落格還有延伸一些預測會賺多少的介紹。                     </p><a href="http://www.bituzi.com/2014/12/Rbacktest6mins.html">http://www.bituzi.com/2014/12/Rbacktest6mins.html</a></dd></dl></section>                 <section>                     <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:a742b24a-9d6c-46a7-a917-fff05100874d" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8cData+Science+%e5%88%b0%e5%ba%95%e6%98%af%e4%bb%80%e9%ba%bc%e5%be%9e%e4%b8%80%e5%80%8b%e5%ae%8c%e5%85%a8%e5%a4%96%e8%a1%8c%e8%a7%92%e5%ba%a6%e4%be%86%e7%9c%8b%e3%80%8d" rel="tag">「Data Science 到底是什麼從一個完全外行角度來看」</a>,<a href="/tags/data+science" rel="tag">data science</a>,<a href="/tags/data+processing" rel="tag">data processing</a>,<a href="/tags/R" rel="tag">R</a></div></section>