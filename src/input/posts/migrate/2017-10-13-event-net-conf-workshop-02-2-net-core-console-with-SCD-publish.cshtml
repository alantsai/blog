Title: "[.Net Core 與 .Net Standard 實戰教學][Lab][02-2]了解Self Contained Deployment(SCD)執行(發佈)模式"
Published: 2017-10-13 20:00
Modified: 2017-10-13 20:00
Image: /posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb(42).png
Tags: ["lab","「.net core 與 .net standard 實戰教學」","net-core"]
RedirectFrom: 2017/10/event-net-conf-workshop-02-2-net-core-console-with-SCD-publish.html
Series: ["「.Net Core 與 .Net Standard 實戰教學」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-2DMr45Etvj8/Wd-4ISwZ1ZI/AAAAAAAAWhs/n-cyXU52adMnl-8C_CzbWx_XLHxuTclwACHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb(42).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/workshop-rustic-hammer-wrench-tool-2608390/</figcaption></figure></section><section><p>  在上一個Lab：<a href="http://blog.alantsai.net/2017/10/event-net-conf-workshop-02-1-net-core-console-with-FDD-publish.html">了解Framework Dependent Deployment(FDD)執行(發佈)模式</a>建立了一個.Net Core Console程式，   並且用發佈看產出的結果 - 最後得到的是FDD的執行模式。   </p><p>  在這一個lab將會沿用上一個lab的Solution接下去建立另外一種執行模式，Self Contained Deployment (SCD)。   </p><div class="bs-callout bs-callout-default"><p>    上個lab的最後成果的程式碼可以再github看到：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop">https://github.com/alantsai-samples/2017-10-14-net-core-workshop</a></p><p>    git標籤：<code>lab2/1-fdd-finish</code></p><p>    兩種方式取得：     </p><ol><li>用git clone然後在checkout到<code>lab2/1-fdd-finish</code></li><li>從github release下載：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop/releases/tag/lab2%2F1-fdd-finish">下載鏈接</a></li></ol></div></section>     <section> <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507833474916916" ;="">操作步驟</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507833474917565" ;="">建立另外一個Net Core Console</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507833474917956" ;="">修改csproj變成SDC模式並且發佈Windows版本</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507833474917242" ;="">修改發佈設定 - 建立linux版本</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507833474917455" ;="">參考資料</a><br></li></ul></div></section>     <a name="more"></a><section><h2 id="WizKMOutline_1507833474916916">操作步驟</h2><p>  這個lab裡面會切分以下幾個階段：   </p><ul><li>建立另外一個Net Core Console</li><li>修改csproj變成SDC模式並且發佈Windows版本</li><li>修改發佈設定 - 建立linux版本</li></ul><section><h3 id="WizKMOutline_1507833474917565">建立另外一個Net Core Console</h3><dl><dt>      直接在上一個lab建立出來的solution點 <kbd>右鍵</kbd>，然後選擇 <code>Add</code> -&gt; <code>New Project</code></dt><dd><figure><a href="https://lh3.googleusercontent.com/-yHYGkrY4AeI/Wd-4LB0HXjI/AAAAAAAAWh0/Odet_F6CTSs8YyWEQxwvKREwSXRArB27gCHMYCw/s1600-h/image%255B5%255D"><img width="654" height="452" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[1](36).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      在 新增視窗 裡面 選擇 <code>.Net Core</code> -&gt;<code>Console App (.Net Core)</code></dt><dd><ol><li><code>name</code><code>SCD</code></li></ol><figure><a href="https://lh3.googleusercontent.com/-YOdPs6IQ3aQ/Wd-4N8ANnrI/AAAAAAAAWh8/0Vw7vvNIj8sA-sxmQ9WEwvBiba_LYBTBgCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="310" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[2](30).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      為了 更好區分我們之前建立的<code>FDD</code>專案，打開<code>Program.cs</code>，然後調整 一下輸出的內容 改成     </dt><dd><p><code>Console.WriteLine("Hello World From SCD!");</code></p><p>    最後內容如下：     </p><figure><a href="https://lh3.googleusercontent.com/-cayD1r1evPw/Wd-4QKO1gGI/AAAAAAAAWiE/RFaf4BbPCL8nn14m70VYZrv-CTv88zlQACHMYCw/s1600-h/image%255B11%255D"><img width="654" height="269" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[3](27).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><section><h3 id="WizKMOutline_1507833474917956">修改csproj變成SDC模式並且發佈Windows版本</h3><dl><dt>      對 <code>SCD</code>的專案點 <kbd>右鍵</kbd>然後選擇 <kbd>Edit SCD.csproj</kbd></dt><dd><figure><a href="https://lh3.googleusercontent.com/-xffa73m3UZQ/Wd-4UH_Wx0I/AAAAAAAAWiM/18rGSzh3YdcDZftMleXWaPywcbajvI9LwCHMYCw/s1600-h/image%255B14%255D"><img width="654" height="298" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[4](26).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      在 打開的 編輯器 裡面，在<code>TargetFramework</code>下面加入：     </dt><dd><code>&lt;RuntimeIdentifiers&gt;win-x64;linux-x64&lt;/RuntimeIdentifiers&gt;</code><figure><a href="https://lh3.googleusercontent.com/-daqJUolrcPY/Wd-4XY9ONBI/AAAAAAAAWiU/kazob9b55JcFgMF16N4VklRKjJ7itzuUgCHMYCw/s1600-h/image%255B17%255D"><img width="654" height="228" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[5](20).png" border="0" class="img-responsive"></a></figure><div class="bs-callout bs-callout-info">     輸入的值為RDI，有什麼值可以使用可以參考：<a href="https://docs.microsoft.com/en-us/dotnet/core/rid-catalog">https://docs.microsoft.com/en-us/dotnet/core/rid-catalog</a></div><div class="bs-callout bs-callout-info">     題外話：.Net Core 2.0之後才有所謂的<em>Portable</em>版本，例如<code>linux-x64</code> - 避免需要列出很多不同的linux distro。     </div></dd><dd></dd><dt>      對<code>SCD.csproj</code>點<kbd>右鍵</kbd>，然後選擇<code>Publish</code></dt><dd><figure><a href="https://lh3.googleusercontent.com/-6Cmn_ereLaM/Wd-4dPtZoAI/AAAAAAAAWic/NnQZhtQRSegGtXvYP_WiplN-8PGo-Ft9gCHMYCw/s1600-h/image%255B20%255D"><img width="654" height="373" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[6](17).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      在跳出來的視窗：     </dt><dd><ol><li>選擇 中間的 <code>Folder</code></li><li>選擇 右下角 的 <kbd>publish</kbd></li></ol><figure><a href="https://lh3.googleusercontent.com/-GdB5ofiVEmQ/Wd-4gsiZL9I/AAAAAAAAWik/tryIv6fXQoMuySYxAl6PTLJCT1PbCN33wCHMYCw/s1600-h/image%255B23%255D"><img width="654" height="314" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[7](12).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      這個時候會開始 發佈，注意到 <em>target runtime</em> 的部分（這邊是<code>win-x64</code>），可以打開最後發佈的結果（點<code>Target Location</code>的鏈接），會看到熟悉的exe檔案     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-ak-au9JGe_k/Wd-4iM0gaGI/AAAAAAAAWis/1sbf7Sr-MPEyHTiDh-iqIQj_oJF3LGNrwCHMYCw/s1600-h/image%255B35%255D"><img width="654" height="364" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[11](5).png" border="0" class="img-responsive"></a><a href="https://lh3.googleusercontent.com/-JmDbgTKxoSc/Wd-4nyCXz3I/AAAAAAAAWi0/qEnNdj0m4Rkq0mXcZWV03I17ed90BN3HACHMYCw/s1600-h/image%255B38%255D"><img width="654" height="379" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[12](6).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><section><h3 id="WizKMOutline_1507833474917242">修改發佈設定 - 建立linux版本</h3><dl><dt>      回到 VS 的發佈畫面，可以點下：     </dt><dd><ol><li><code>Settings</code></li><li>在開啟的畫面選擇<code>Target Runtime</code></li><li>改成<code>Linux-x64</code></li></ol><figure><a href="https://lh3.googleusercontent.com/-U8My-rRLobY/Wd-4q5kM2AI/AAAAAAAAWi8/_MxEXxyKzzw-0_bK3wgCZeHLWvJvH7BrQCHMYCw/s1600-h/image%255B41%255D"><img width="654" height="241" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[13](6).png" border="0" class="img-responsive"></a><a href="https://lh3.googleusercontent.com/-hvQ8ZbIsm3k/Wd-4wgkSLTI/AAAAAAAAWjE/1PsUoLxWTqUHqkY-bXpeJMhFGjBEWY87ACHMYCw/s1600-h/image%255B44%255D"><img width="654" height="357" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[14](3).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      這個時候在按一次 <code>publish</code></dt><dd></dd><dd></dd><dt>      檢查 產出 內容 會發現和剛剛 target win-x64的時候不一樣，也沒有exe檔案     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-DZDQ9Lbx7Uc/Wd-40UeXcsI/AAAAAAAAWjM/SSd7w3A85NscRmiIXTaK529YlBiZFMLawCHMYCw/s1600-h/image%255B47%255D"><img width="654" height="487" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-02-2-net-core-console-with-SCD-publish_Asset/image_thumb[15](3).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><div class="bs-callout bs-callout-default"><p>    完整程式碼可以再github看到：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop">https://github.com/alantsai-samples/2017-10-14-net-core-workshop</a></p><p>    git標籤：<code>lab2/2-scd-finish</code></p><p>    兩種方式取得：     </p><ol><li>用git clone然後在checkout到<code>lab2/2-scd-finish</code></li><li>從github release下載：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop/releases/tag/lab2%2F2-scd-finish">下載鏈接</a></li></ol></div></section><section><h2 id="WizKMOutline_1507833474917455">參考資料</h2><dl><dt>        官方介紹 SCD         </dt><dd><a href="https://docs.microsoft.com/en-us/dotnet/core/deploying/deploy-with-vs#simpleSelf">https://docs.microsoft.com/en-us/dotnet/core/deploying/deploy-with-vs#simpleSelf</a></dd><dt>        RDI - 指定的target runtime       </dt><dd><a href="https://docs.microsoft.com/en-us/dotnet/core/rid-catalog">https://docs.microsoft.com/en-us/dotnet/core/rid-catalog</a></dd><dd></dd></dl></section><section>    <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:63b642ee-f6d4-40d1-8db7-860115667cf1" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c.Net+Core+%e8%88%87+.Net+Standard+%e5%af%a6%e6%88%b0%e6%95%99%e5%ad%b8%e3%80%8d" rel="tag">「.Net Core 與 .Net Standard 實戰教學」</a>,<a href="/tags/net-core" rel="tag">net-core</a>,<a href="/tags/lab" rel="tag">lab</a></div></section>