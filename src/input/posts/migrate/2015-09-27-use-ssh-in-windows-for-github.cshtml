Title: "何謂ssh？在Windows下如何使用ssh？如何在Windows透過ssh下載和上傳程式到github?"
Published: 2015-09-27
Modified: 2016-03-07
Image: /posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[2](62).png
Tags: ["ssh","git"]
RedirectFrom: 2015/09/use-ssh-in-windows-for-github.html
Series: []
---
<a id="KMContentPageTopID" name="KMContentPageTopID"></a> <div id="divKMOutline" style="border-top-style: groove; border-bottom-style: groove; border-right-style: none; margin: 10px 0px; border-left-style: none"><ul style="margin: 0px 0px 0px 30px"><li><a href="#WizKMOutline_1443285321782100" ;="">什麼是ssh</a></li><li><a href="#WizKMOutline_1443285321782995" ;="">為什麼在Windows 要用 ssh</a></li><li><a href="#WizKMOutline_1443285321782980" ;="">為什麼ssh比telnet還安全？何謂ssh key？</a></li><li><a href="#WizKMOutline_1443285321782637" ;="">在Windows使用ssh需要什麼？</a></li><li><a href="#WizKMOutline_1443285321782855" ;="">關鍵exe和參數介紹</a></li><li><a href="#WizKMOutline_1443285321782232" ;="">一步一步設定用作於Github的ssh key</a>  <ul style="margin: 0px 0px 0px 30px"><li><a href="#WizKMOutline_1443285321782714" ;="">第0步 - 設定OpenSSH的資料夾路徑到path裡面</a></li><li><a href="#WizKMOutline_1443285321782915" ;="">第1步 - 建立ssh key</a></li><li><a href="#WizKMOutline_1443285321782713" ;="">第2步 - 把public key加入到github</a></li><li><a href="#WizKMOutline_1443285321782748" ;="">第3步 - 測試設定是否成功</a></li><li><a href="#WizKMOutline_1443285321782656" ;="">第4步 - 設定ssh passphrase，避免每一次都需要重新輸入</a></li><li><a href="#WizKMOutline_1443285321782657" ;="">第5步 - 取得Github專案的ssh連線</a> </li>   </ul></li><li><a href="#WizKMOutline_1443285321782951" ;="">結語</a></li><li><a href="#WizKMOutline_1443285321782213" ;="">其他資料</a></li>   </ul></div><p>對於一個完全沒有使用過Linux系統的人，要了解如何使用ssh其實是有一些門檻。不過隨著一些工具的出現，Windows使用者會使用到一些Linux的工具。最明顯莫過於git的版控系統。 </p><p>git非常的好用，不過由於它是由Linux創始人所設計開發出來，因此裡面有一些工具是Linux天天在使用。而ssh就是其中一個工具。 </p><p>這篇文章將會用我自己所理解的方式來說明ssh，和如何使用ssh來和github溝通。 </p>
<section>
    		<div class="bs-callout bs-callout-info">
			<h4>更新記錄</h4>
			<ol>
                <li>2018/11/22 - <a href="/posts/2018/11/faq-start-sshagent-error-1058-on-windows-1803-cannot-use-ssh-agent">[faq]Windows 1803之後git for windows無法透過Start-SshAgent啓用ssh agent - 需要一直輸入passphrase的問題</a> - Windows 1803如果呼叫有問題的話可以參考</li>
            </ol>
		</div>

</section>
<a name="more"></a> <h2 id="WizKMOutline_1443285321782100">什麼是ssh</h2><div class="bs-callout bs-callout-warning">由於我沒有用過Linux，因此這篇有些說明可能有些地方不夠精準，如果有誤，請大家幫忙指正。 </div><p>ssh是<code>Secure SHell protocl</code>的縮寫，基本上可以把它想成是有加密過的<code>telnet</code>。不過如果你和我一樣只是聽過telnet這個名詞，那其實還是不了解ssh是什麼。 </p><p>以我自己的理解是，ssh和telnet其實就是用<em>shell 的方式連到遠端電腦</em>。在Windows世界裡面，連到另外一台電腦都是透過Remote Desktop Connection（遠端連線工具），而Remote Desktop Connection是有GUI的界面，而ssh和telnet則是透過shell（command line）的方式連到電腦。 </p><h2 id="WizKMOutline_1443285321782995">為什麼在Windows 要用 ssh</h2><p>因為在Windows下面有時候會需要連線到Linux的服務。以我來說，使用git版控的時候，當想要把source code push到online repository（例如github或者bitbucket）的時候，都是建議使用ssh做連線。 </p><p>或許你會說，可是online repository都有接受用https的方式做連線，為什麼要用ssh？ </p><p>主要有兩個原因： </p><ol><li>有些情況用不了https - 例如開了two step verification（兩步驗證）在bitbucket就用不了https（不過github開了兩步驗證還是可以用產生application的密碼來連https） </li><li>用https每一次都需要打密碼 - ssh可以不用</li>   </ol><h2 id="WizKMOutline_1443285321782980">為什麼ssh比telnet還安全？何謂ssh key？</h2><p>telnet和ssh是同類型的東西。差別在於，ssh的連線通道是經過加密。ssh使用所謂的public 和 private key的Architecture來做連線通道的加解密。 </p><p>簡單來說，public 和 private key是2個不同的檔案。如果資訊透過一個key來加密，那麼另外一個key就可以用於解密。而通常public key是給<em>外部系統用</em>，而private key則是<em>自己用</em>，因此才能夠雙方溝通。 </p><p>為了進一步保護key，設定key的時候通常會在設定一組密碼稱之為<em>passphrase</em>。 </p><p>通常來說： </p><ol><li>public key - 檔名 預設是<code>id_rsa.pub</code></li><li>private key - 檔名 預設是<code>id_rsa</code></li>   </ol><p>如果上面看不太懂，講白一點就是，ssh key類似一個憑證需要在雙方電腦設定好才能夠溝通。然後passphrase就是密碼。 </p><h2 id="WizKMOutline_1443285321782637">在Windows使用ssh需要什麼？</h2><p>在Windows有2種類型的程式可以支援ssh： </p><ol><li>command line工具 - 通常是指 OpenSSH </li><li>GUI工具 - PuTTY</li>   </ol><p>在安裝完了git，會自動帶OpenSSH。因此這這篇介紹的工具就是用OpenSSH。 </p><h2 id="WizKMOutline_1443285321782855">關鍵exe和參數介紹</h2><p>下面先介紹之後會用到的一些參數和exe檔案說明。 </p><div class="table-responsive"><table class="table table-bordered"><tbody><tr> <th>程式/參數</th> <th>說明</th></tr><tr> <td>OpenSSH程式位置</td> <td> <p><code>{Git安裝路徑}\usr\bin</code></p><p><code>%programfiles%\Git\usr\bin</code></p><p>以我的電腦的地方是在：<code>C:\Program Files\Git\usr\bin</code></p><p>下面的程式都是在OpenSSH的程式位置資料夾裡面 </p></td></tr><tr> <td>ssh key預設位置</td> <td> <p>Linux是：<code>~/.ssh</code></p><p>Windows在：<code>%userprofile%\.ssh</code></p><p>這邊要注意有些設定要用Linux的語法 - 因為有些工具還是使用linux的位置。 </p></td></tr><tr> <td>ssh key預設檔案名稱 </td> <td> <ol><li>public key - 檔名 預設是<code>id_rsa.pub</code></li><li>private key - 檔名 預設是<code>id_rsa</code></li>   </ol></td></tr><tr> <td>ssh.exe </td> <td>ssh的主要程式，用作於連ssh。 </td></tr><tr> <td>ssh-kegen.exe </td> <td>用來產生ssh需要的key。 </td></tr><tr> <td>ssh-agent.exe </td> <td>一個程式用來記錄每一個ssh key的passphrase的工具。讓連ssh的時候不需要一直輸入passphrase。 </td></tr><tr> <td>ssh-add.exe </td> <td>管理ssh-agent.exe記錄的passphrase </td></tr></tbody></table></div><h2 id="WizKMOutline_1443285321782232">一步一步設定用作於Github的ssh key</h2><p>這邊我會介紹如何從無到有設定github，然後用ssh方式連到repo。 </p><div class="bs-callout bs-callout-info">下面的cmd操作我都是使用PowerShell。因為PowerShell裡面有一個posh-git讓用PowerShell操作git變得很方便。 </div><h3 id="WizKMOutline_1443285321782714">第0步 - 設定OpenSSH的資料夾路徑到path裡面</h3><p>因為之後操作都是用PowerShell，因此如果把OpenSSH的資料夾放到path裡面方便操作，因此開啟PowerShell之後，直接執行下面指令即可 </p><pre class="brush: ps;"><code class="language-powershell line-numbers">[Environment]::SetEnvironmentVariable("Path", "$env:Path;$env:programfiles\Git\usr\bin", "User")
</code></pre><h3 id="WizKMOutline_1443285321782915">第1步 - 建立ssh key</h3><p>首先第一步是先建立.ssh的資料夾： </p><pre class="brush: ps;"><code class="language-powershell line-numbers">New-Item -ItemType Directory "$env:USERPROFILE/.ssh" -Force
</code></pre><p>再來是移動到剛剛建立的.ssh資料夾： </p><pre class="brush: ps;"><code class="language-powershell line-numbers">cd $env:USERPROFILE/.ssh
</code></pre><p>透過<code>ssh-keygen</code>產生出ssh key。其中<code>-f</code>的參數是key的名稱，然後<code>-C</code>則是這個key的id（其實我不太確定是什麼，不過大部分都是說輸入email） </p><pre class="brush: ps;"><code class="language-powershell line-numbers">ssh-keygen -f id_rsa -C "alan@@alantsai.net"
</code></pre><p>這個時候會請你輸入passphrase，建議要輸入，這個會在每次做ssh的時候要求輸入。如果不想設passphrase，直接按下<kbd>enter</kbd>就好。 </p><figure><a href="http://lh3.googleusercontent.com/-peaiEiY9XTA/VgbQmUXvK7I/AAAAAAAAPWw/9l2KLxzPq58/s1600-h/image%25255B4%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[2](62).png" width="447" height="103" class="img-responsive"></a><figcaption>用ssh-keygen產生ssh key</figcaption></figure>  <p>做完了之後，在<code>%userprofile%/.ssh</code>應該就會看到兩個檔案： </p><ol><li>id_rsa  </li><li>id_rsa.pub</li>   </ol><figure><a href="http://lh3.googleusercontent.com/-vyGtpwbuhWE/VgbQoCUUMjI/AAAAAAAAPXA/nyGGRsSJLBE/s1600-h/image%25255B8%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[4](58).png" width="324" height="103" class="img-responsive"></a><figcaption>確認產生的key</figcaption></figure>  <h3 id="WizKMOutline_1443285321782713">第2步 - 把public key加入到github</h3><p>用一個檔案編輯器打開<code>id_rsa.pub</code>，然後把所有內容複製下來。 </p><figure><a href="http://lh3.googleusercontent.com/-5KVjVV8PD2E/VgbQp3UBDwI/AAAAAAAAPXQ/6Ut6PxWR7HE/s1600-h/image%25255B12%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[6](37).png" width="273" height="298" class="img-responsive"></a><figcaption>複製public key</figcaption></figure>  <p>這時候在到github，然後在<kbd>Settings</kbd>裡面找到<kbd>SSH Keys</kbd>，然後選<kbd>Add SSH key</kbd>。在<code>key</code>的部分貼上剛剛從public key複製的內容。至於<code>title</code>主要是給自己看的名稱。 </p><figure><a href="http://lh3.googleusercontent.com/-MH9S7AO7WgA/VgbQsC7uQCI/AAAAAAAAPXg/ELcW7FeMHZw/s1600-h/image%25255B17%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[9](18).png" width="572" height="319" class="img-responsive"></a><figcaption>在Github設定ssh key</figcaption></figure>  <h3 id="WizKMOutline_1443285321782748">第3步 - 測試設定是否成功</h3><div class="bs-callout bs-callout-info">要注意，在做這個之前先把剛剛的PowerShell關掉，然後在開起來。這樣才會抓到心得key。 </div><p>上面都設定完成了之後，可以用下面指令來測試： </p><pre class="brush: ps;"><code class="language-powershell line-numbers">ssh -T git@@github.com
</code></pre><p>因為從來沒有連過會需要確認是否允許連線，這個時候輸入<kbd>yes</kbd>就可以。</p><p>看到下面畫面就成功了。 </p><figure><a href="http://lh3.googleusercontent.com/-WXrUjZOzt7w/VgbQuU1OzPI/AAAAAAAAPXw/3VyToYhGnRw/s1600-h/image%25255B23%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[13](17).png" width="584" height="102" class="img-responsive"></a><figcaption>測試github ssh key</figcaption></figure>  <div class="bs-callout bs-callout-warning">如果出現：<code>Permission denied (publickey).</code>表示沒有設定成功。 </div><h3 id="WizKMOutline_1443285321782656">第4步 - 設定ssh passphrase，避免每一次都需要重新輸入</h3><p>做到上面為止，其實連線都沒問題了，但是每一次都要輸入<em>passphrase</em>其實很煩，因此我們可以透過<code>ssh-agent</code>這個服務，能夠記錄住ssh key 的 passphrase。 </p><p>可以透過<code>ssh-add -l</code>來先確認是否有任何key有記錄passphrase。 </p><figure><a href="http://lh3.googleusercontent.com/-ef_BkEgfGNU/VgbQyGjttbI/AAAAAAAAPYA/Zg3mmKJzwu0/s1600-h/image%25255B27%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[15](9).png" width="334" height="65" class="img-responsive"></a><figcaption>測試目前設定的ssh-agent</figcaption></figure>  <p>可以透過<code>ssh-add {key path}</code>來加入key 的passphrase，因此： </p><pre class="brush: ps;"><code class="language-powershell line-numbers">ssh-add id_rsa
</code></pre><p>這個時候在用<code>ssh-add -l</code>，會看到多了一筆。 </p><figure><a href="http://lh3.googleusercontent.com/-ki33Xt-P_wo/VgbQ4cA3WAI/AAAAAAAAPYQ/HAK1c414F4I/s1600-h/image%25255B31%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[17](7).png" width="451" height="74" class="img-responsive"></a><figcaption>確認是否加入成功</figcaption></figure>  <div class="bs-callout bs-callout-info">如果你在Windows的git用的是<code>Posh-git</code>，那麼不用做任何事情ssh-agent會自動被啟動。不過如果不是，會需要做一些設定。可以參考：<a href="https://confluence.atlassian.com/bitbucket/set-up-ssh-for-git-728138079.html">Set up SSH for Git</a> 其中 <code>Step 4. Update your .bashrc profile file</code>。</div><h3 id="WizKMOutline_1443285321782657">第5步 - 取得Github專案的ssh連線</h3><p>到任何一個repo，然後在右邊copy ssh的連線，之後就用那個連線做<code>clone</code>就可以。然後<code>push</code>的時候自動就會上去。 </p><figure><a href="http://lh3.googleusercontent.com/-6RPsZ165YtM/VgbQ7V4PFwI/AAAAAAAAPYg/u-XH4ZgfFKg/s1600-h/image%25255B35%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2015-09-27-use-ssh-in-windows-for-github_Asset/image_thumb[19](6).png" width="458" height="285" class="img-responsive"></a> <figcaption>github repo ssh 連線</figcaption></figure>  <h2 id="WizKMOutline_1443285321782951">結語</h2><p>希望透過這一篇，能夠對於在Windows使用ssh變的更加容易，並且要用在git的public repository例如github和bitbucket都會非常的方便和容易。 </p><p>不過需要注意一件事情，假設今天你使用的不是用PowerShell的Posh-git方式操作git，那麼可能需要再做一些其他設定。 </p><p>在下一篇我會在介紹，當有2個以上的ssh key的時候要怎麼設定。可以想象，當你github和bitbucket用2個不同ssh key的時候，要如何處理。 </p><h2 id="WizKMOutline_1443285321782213">其他資料</h2><div><ul><li>如果沒有用過指令方式操作git，建議可以試試。可以看看我之前做的簡報 <iframe src="//www.slideshare.net/slideshow/embed_code/key/5FSHVOv02jti0n" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen=""> </iframe> <div style="margin-bottom:5px"><strong> <a href="//www.slideshare.net/alantsai2007/git-48778340" title="工程師必備第一工具 - Git" target="_blank" rel="noopener">工程師必備第一工具 - Git</a> </strong> from <strong><a href="//www.slideshare.net/alantsai2007" target="_blank" rel="noopener">Alan Tsai</a></strong> </div></li><li><a href="http://haacked.com/archive/2011/12/19/get-git-for-windows.aspx/">Configure Git in PowerShell So You Don’t Have to Enter Your Password All the Damn Time</a> - 介紹Posh-Git帶來自動啟動ssh-agent的說明。  </li><li><a href="http://corlewsolutions.com/articles/article-11-guide-to-setting-up-ssh-on-windows-7">Guide To Setting Up SSH on Windows 7</a> - SSH相關exe的使用  </li><li><a href="https://help.github.com/articles/generating-ssh-keys/">Generating SSH keys</a> - Github介紹產生ssh key  </li><li><a href="https://confluence.atlassian.com/bitbucket/set-up-ssh-for-git-728138079.html">Set up SSH for Git</a> -&nbsp; Atlassain (Bitbucket公司)介紹產生ssh key  </li><li><a href="https://confluence.atlassian.com/bitbucket/troubleshoot-ssh-issues-271943403.html">Troubleshoot SSH Issues</a> - Atlassain (Bitbucket公司)介紹如何測試ssh問題  </li><li><a href="http://linux.vbird.org/linux_server/0310telnetssh.php#ssh_server">第十一章、遠端連線伺服器SSH / XDMCP / VNC / RDP</a> - 鳥哥介紹SSH </li>   </ul></div><div id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:716e5a41-8080-4fd5-bdad-0b42fa9f214c" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px">blogspot 的標籤: <a href="/tags/git" rel="」tag」">git</a>,<a href="/tags/ssh" rel="」tag」">ssh</a></div>
