Title: "[.Net Core 與 .Net Standard 實戰教學][Lab][03-2]使用.NET API Portability分析API支援程度"
Published: 2017-10-13 22:00
Modified: 2017-10-13 22:00
Image: /posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb(44).png
Tags: ["net-standard","lab","「.net core 與 .net standard 實戰教學」","net-core"]
RedirectFrom: 2017/10/event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support.html
Series: ["「.Net Core 與 .Net Standard 實戰教學」"]
---
<section><figure>    <a href="https://lh3.googleusercontent.com/-SAI-zrf-1sk/WeCqBZESxQI/AAAAAAAAWmU/ijOJJthNygQNTOsdKCYUNAP5ECGrJbV8QCHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb(44).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/workshop-rustic-hammer-wrench-tool-2608390/</figcaption></figure></section><section><p>  在上一個lab：<a href="http://blog.alantsai.net/2017/10/event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard.html">[03-1]現有.Net Framework Lib 改成 .Net Standard</a> 了解了如何把一個現行的.Net Framework邏輯移轉到Target .Net Standard以達到最大跨平台共用邏輯的需求。在操作的過程中有特意轉成.Net Standard 1.6來模擬不支援的api <code>DataSet</code>，   並且了解如何使用 Api Browser來查看api支援度。   </p><p>  不過，難道沒有工具能夠分析現行程式碼是否支援那些target嗎？   </p><p>  在這一個lab將會使用<em><strong>.NET API Portability</strong></em>來達到分析支援度的情況。   </p><div class="bs-callout bs-callout-default"><p>    上個lab的最後成果的程式碼可以再github看到：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop">https://github.com/alantsai-samples/2017-10-14-net-core-workshop</a></p><p>    git標籤：<code>lab3/1-port-net-standard-finish</code></p><p>    兩種方式取得：     </p><ol><li>用git clone然後在checkout到<code>lab3/1-port-net-standard-finish</code></li><li>從github release下載：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop/releases/tag/lab3%2F1-port-net-standard-finish">下載鏈接</a></li></ol></div></section>     <section> <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507895436907717" ;="">操作步驟</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507895436907350" ;="">安裝.NET API Portability</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507895436908951" ;="">設定和對專案進行分析</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507895436908217" ;="">檢視結果</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507895436908248" ;="">相關資源</a><br></li></ul></div></section>     <a name="more"></a><section><h2 id="WizKMOutline_1507895436907717">操作步驟</h2><ul><li>安裝<code>.NET API Portability</code></li><li>設定和對專案進行分析</li><li>檢視結果</li></ul><section><h3 id="WizKMOutline_1507895436907350">安裝.NET API Portability</h3><dl><dt>      下載並且安裝套件 .NET API Portability     </dt><dd><p>     可以再這個鏈接下載到：      <a href="https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer">https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer</a></p><p>    目前支援：     </p><ul><li>Visual Studio 2015</li><li>Visual Studio 2017</li></ul><p>    先把所有Visual Studio關掉。     </p><p>    然後對下載下來的vsix點兩下。     </p><p>    安裝和一般VS套件一樣，就是下一步到底。     </p></dd><dd></dd></dl></section><section><h3 id="WizKMOutline_1507895436908951">設定和對專案進行分析</h3><dl><dt>      對<code>NorthwindDalNetStandard</code>專案 點 <kbd>右鍵</kbd> -&gt; 選擇 <code>Portability Analyzer Settings</code></dt><dd><figure><a href="https://lh3.googleusercontent.com/-j2fqCt-_puU/WeCqO2O_E5I/AAAAAAAAWmc/P6p5WfkdRwogHM0OaApsJEECpQg-JJ39wCHMYCw/s1600-h/image%255B5%255D"><img width="654" height="331" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb[1](38).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      在打開的視窗，能夠 設定：     </dt><dd><ol><li>分析結果的檔案格式</li><li>要對那個platform分析</li></ol><figure><a href="https://lh3.googleusercontent.com/-CUv9GViF130/WeCqYo1moeI/AAAAAAAAWmk/VswZTPlVa3QVIb6T0sT98BMJCRrfG81_QCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="457" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb[2](32).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      設定好了之後，對 <code>NorthwindDalNetStandard</code>點 <kbd>右鍵</kbd> -&gt; <code>Analyze Project Portability</code></dt><dd><figure><a href="https://lh3.googleusercontent.com/-qr57225X4jk/WeCqkNOIPEI/AAAAAAAAWms/f3CPYuoDgYohhbJpusKdzxTSTya0xM3GgCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="394" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb[3](29).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      執行完了之後，會跳出一個視窗，可以點產生出來的excel     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-oMYt0qzrfZ0/WeCqsG6vdCI/AAAAAAAAWm4/F7fzqk51ndUKLvyEGFh9JyzjkEk-XKDMACHMYCw/s1600-h/image%255B14%255D"><img width="654" height="184" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb[4](28).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><section><h3 id="WizKMOutline_1507895436908217">檢視結果</h3><dl><dt>      第一頁簽是結論，可以看出來 .Net Standard 1.6有部分不支援     </dt><dd>      格子有被標黃，並且數字不是100，表示只有 75.93 的api在.Net Standard 1.6是有支援      <figure><a href="https://lh3.googleusercontent.com/-Q8dRMbveMyc/WeCq2m70ZoI/AAAAAAAAWnA/HvWE3zlrYX4AzuYYeruordQFY97Vv333QCHMYCw/s1600-h/image%255B17%255D"><img width="654" height="137" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb[5](22).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      切換下面的頁簽到<code>Details</code></dt><dd>      可以看到詳細的API，並且有問題的都是<code>DataSet</code>的部分 - 這個分析結果甚至能夠告訴你 .Net Standard 2.0就有支援了      <figure><a href="https://lh3.googleusercontent.com/-4og_pPl3078/WeCq9PcSYdI/AAAAAAAAWnI/IluFTXJNIQIK2R4_mQOfoMkPC6ydk6j0wCHMYCw/s1600-h/image%255B20%255D"><img width="654" height="170" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-2-use-net-api-portability-analyze-platform-support_Asset/image_thumb[6](18).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><p>  透過.NET API Portability 工具能夠分析的出一個粗略轉到.Net Standard會需要花的工，因此可以用來做一個事前的工作量評估工具。   </p><p>  不過還是要注意，這個只是一個參考值，有些問題可能會是runtime才遇到，那這個工具就無能為力。   </p></section><section><h2 id="WizKMOutline_1507895436908248">相關資源</h2><dl><dt>     官方github repo    </dt><dd><a href="https://github.com/microsoft/dotnet-apiport">https://github.com/microsoft/dotnet-apiport</a></dd><dd></dd><dt>     Visual Studio Marketplace 下載    </dt><dd><a href="https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer">https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer</a></dd><dd></dd><dt>     官方文件介紹    </dt><dd><a href="https://docs.microsoft.com/zh-tw/dotnet/standard/portability-analyzer">https://docs.microsoft.com/zh-tw/dotnet/standard/portability-analyzer</a></dd><dd></dd></dl></section><section>   <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:41b796a4-c1e0-4661-8cc9-88ea22ed07b9" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c.Net+Core+%e8%88%87+.Net+Standard+%e5%af%a6%e6%88%b0%e6%95%99%e5%ad%b8%e3%80%8d" rel="tag">「.Net Core 與 .Net Standard 實戰教學」</a>,<a href="/tags/lab" rel="tag">lab</a>,<a href="/tags/net-core" rel="tag">net-core</a>,<a href="/tags/net-standard" rel="tag">net-standard</a></div></section>