Title: "[.Net Core 與 .Net Standard 實戰教學][Lab][03-1]現有.Net Framework Lib 改成 .Net Standard"
Published: 2017-10-13 21:00
Modified: 2017-10-13 21:00
Image: /posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb(43).png
Tags: ["net-standard","lab","「.net core 與 .net standard 實戰教學」","net-core"]
RedirectFrom: 2017/10/event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard.html
Series: ["「.Net Core 與 .Net Standard 實戰教學」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-ObswyaamZvo/Wd_7urb8UAI/AAAAAAAAWjs/_Qjlxin5W3ULo8Z6meNTFjc2MWQgZlx5wCHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb(43).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/workshop-rustic-hammer-wrench-tool-2608390/</figcaption></figure></section><section><p>  在前兩個lab 2裡面(<a href="http://blog.alantsai.net/2017/10/event-net-conf-workshop-02-1-net-core-console-with-FDD-publish.html">[Lab2-1]了解Framework Dependent Deployment(FDD)執行(發佈)模式</a>、   <a href="http://blog.alantsai.net/2017/10/event-net-conf-workshop-02-2-net-core-console-with-SCD-publish.html">[Lab2-2]了解Self Contained Deployment(SCD)執行(發佈)模式</a>)了解了.Net Core和.Net Framework 不同執行模式以後。   </p><p>  在lab 3將會切換到另外一個很重要的部分，<em><strong>.Net Standard 2.0</strong></em>的到來。   </p><p>  這個lab將會介紹如何移轉現有target .net Framework的程式改成.Net Standard以達到多runtime使用重複邏輯。   </p><div class="bs-callout bs-callout-info">   一般來說會先port test程式碼，在port實際的業務程式碼，不過做法都類似，以這個範例就直接port業務程式碼。   </div></section>   <section> <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507850726674357" ;="">操作步驟</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507850726675855" ;="">取得一個WinForm的ap模擬一個要轉移的AP</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507850726675573" ;="">建立一個.Net Standard 1.6的lib，嘗試轉移出現錯誤 - 了解如何檢查api版本</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507850726675745" ;="">建立一個.net core console使用建立出來的.Net Standard Lib</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1507850726675682" ;="">參考資料</a><br></li></ul></div></section>   <a name="more"></a><section><h2 id="WizKMOutline_1507850726674357">操作步驟</h2><ol><li>取得一個WinForm的ap模擬一個要轉移的AP</li><li>建立一個.Net Standard 1.6的lib，嘗試轉移出現錯誤 - 了解如何檢查api版本</li><li>建立一個.net core console使用建立出來的.Net Standard Lib</li></ol><section><h3 id="WizKMOutline_1507850726675855">取得一個WinForm的ap模擬一個要轉移的AP</h3><dl><dt>      先取得模擬舊ap的.net framework程式     </dt><dd>      可以兩個方式取得：      <ol><li><ul><li>用git <code>clone</code>：<code>https://github.com/alantsai-samples/2017-10-14-net-core-workshop.git</code></li><li>用 git <code>checkout</code>切換到branch：<code>lab3/1-port-net-standard-start</code></li><li>          瀏覽到：<code>src\lab3-port-to-net-standard</code> - 複製這個資料夾出來          <figure><a href="https://lh3.googleusercontent.com/-6Es8X4XyzKQ/Wd_8Q3HHD7I/AAAAAAAAWj0/B3pi_zuxEjcKiirhwbt9nNk0EZxJeisTgCHMYCw/s1600-h/image%255B5%255D"><img width="654" height="173" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[1](37).png" border="0" class="img-responsive"></a><br><figcaption>看到：LegacyApplication.sln</figcaption></figure></li></ul></li><li><p>       可以使用 <a href="http://kinolien.github.io/gitzip/">http://kinolien.github.io/gitzip/</a>來下載，做法如下：         </p><ol><li>網址輸入：<code>http://kinolien.github.io/gitzip/</code></li><li>鏈接輸入：<code>https://github.com/alantsai-samples/2017-10-14-net-core-workshop/tree/lab3/1-port-net-standard-start/src/lab3-port-to-net-standard</code></li><li>按下 <kbd>Download</kbd></li></ol><figure><a href="https://lh3.googleusercontent.com/-3JaH2SwEfzU/Wd_8WC638NI/AAAAAAAAWj8/IvvKdWLi8IYMfiRECJ3lCuaaVpaJv2lNACHMYCw/s1600-h/image%255B8%255D"><img width="654" height="150" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[2](31).png" border="0" class="img-responsive"></a><br></figure><p>       或者使用<a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/alantsai-samples/2017-10-14-net-core-workshop/tree/lab3/1-port-net-standard-start/src/lab3-port-to-net-standard">https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/alantsai-samples/2017-10-14-net-core-workshop/tree/lab3/1-port-net-standard-start/src/lab3-port-to-net-standard</a> 來直接下載開始檔案。        </p></li></ol></dd><dd></dd><dt>      測試現行AP     </dt><dd>      直接run起來，這是一個模擬找出所有在<code>英國</code>的員工並且列出來。      <figure><a href="https://lh3.googleusercontent.com/-UlWNNgul9cY/Wd_8e7hkGRI/AAAAAAAAWkI/Jc6weyfQIE0Ba0pj7Azeam2PKJhyM1eUQCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="298" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[3](28).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><section><h3 id="WizKMOutline_1507850726675573">建立一個.Net Standard 1.6的lib，嘗試轉移出現錯誤 - 了解如何檢查api版本</h3><dl><dt>      在<code>LegacyApplication</code>的sln點 <kbd>右鍵</kbd> -&gt; <code>New Project</code>，然後在彈出的畫面輸入：     </dt><dd><ol><li>先選擇 <code>.Net Standard</code></li><li>再選<code>Class Library（.net Standard)</code></li><li>輸入框Name：<code>NorthwindDalNetStandard</code></li></ol><figure><a href="https://lh3.googleusercontent.com/-XLCA73SZV_A/Wd_8h2L2ZJI/AAAAAAAAWkQ/AIzAH6FBooYj6qtN_hZxsw-Uv2_3CRX-gCHMYCw/s1600-h/image%255B14%255D"><img width="654" height="454" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[4](27).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      這個時候會建立出一個.net standard的library專案     </dt><dd><ol><li>對<code>NorthwindDalNetStandard</code>點 <kbd>右鍵</kbd></li><li>選擇 <code>Properties</code></li><li>把 <code>Target Framework</code>改成<code>.Net Standrd 1.6</code></li></ol><figure><a href="https://lh3.googleusercontent.com/-L8PX7G5ownE/Wd_8nxIeLaI/AAAAAAAAWkY/VOE6PynREPoZOa4S4xLnCqD0XYh3vGkbgCHMYCw/s1600-h/image%255B17%255D"><img width="654" height="341" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[5](21).png" border="0" class="img-responsive"></a><figcaption>模擬建立出來的是.Net Standard 1.6的lib</figcaption></figure></dd><dd></dd><dt>      從<code>LegacyApplication.View</code>專案裡面把<code>northwind.xml</code>和<code>NorthwindDal.cs</code>複製一份到<code>NorthwindDalNetStandard</code>專案底下，最後結果如下     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-cz0J5w7CUB8/Wd_8sMUHWuI/AAAAAAAAWkg/ZTTiHSZI6H4rzY1XBK2kc2cmPP8AbJzfQCHMYCw/s1600-h/image%255B23%255D"><img width="636" height="646" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[7](13).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      把專案 Build，會出現錯誤，發生DataSet找不到的情況     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-WZx4IrMzOhY/Wd_8zERW3LI/AAAAAAAAWko/CyIn-vRT8b837fqavo8bD6IMdlv1MUqzQCHMYCw/s1600-h/image%255B26%255D"><img width="654" height="478" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[8](13).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      可以使用 .Net Api Browser來檢查api支援度     </dt><dd><a href="https://docs.microsoft.com/zh-tw/dotnet/api/?view=netstandard-1.6">https://docs.microsoft.com/zh-tw/dotnet/api/?view=netstandard-1.6</a> - 會發現<code>DataSet</code>並不存在      <figure><a href="https://lh3.googleusercontent.com/-5I8w-LIVIK0/Wd_86z3JoTI/AAAAAAAAWkw/X0JF7pGm8jcR3RjWTyk6mYh8ZVzLWqbPgCHMYCw/s1600-h/image%255B29%255D"><img width="654" height="371" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[9](4).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      而在 .Net Standard 2.0 有     </dt><dd><ol><li>點選 .Net Standard 1.6</li><li>選擇.Net Standard</li><li>選擇版本為2.0</li><li>可以看到就有支援DataSet</li></ol><figure><a href="https://lh3.googleusercontent.com/-uKQLk4mINMk/Wd_897HH5iI/AAAAAAAAWk8/jbZaqM9qfucYze_on70hMhz96TWq0rQnQCHMYCw/s1600-h/image%255B32%255D"><img width="654" height="441" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[10](4).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      把Target從1.6轉回到2.0 在build就沒有問題了     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-qFfDFutC2xM/Wd_9GdBFtPI/AAAAAAAAWlE/5s9DtNXVV_QUq5vlVfvumHfpzuvLEDlXwCHMYCw/s1600-h/image%255B35%255D"><img width="654" height="286" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[11](6).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      把 <code>northwind.xml</code>和<code>NorthwindDal.cs</code>從<code>LegacyApplication.View</code>專案刪掉，並且把<code>NorthwindDalNetStandard</code>加入到reference，最後樣子如下：     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-Brev4xJaZdE/Wd_9NY43oqI/AAAAAAAAWlM/KUJ9TiScCWMT1HDiVUqlGfg_Afr0oF2zgCHMYCw/s1600-h/image%255B38%255D"><img width="654" height="870" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[12](7).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      最後，把<code>LegacyApplication.View</code>專案調整<code>target framework</code></dt><dd><ol><li>對 <code>LegacyApplication.View</code>點右鍵</li><li>選擇<code>Properties</code></li><li><code>Target Framework</code>改成<code>.Net Framework 4.6.2</code></li></ol><figure><a href="https://lh3.googleusercontent.com/-DScco-tdyRE/Wd_9UK5Ge9I/AAAAAAAAWlU/jKpK4KbpcQwdMh67I2LhJzWTln0wz5qXwCHMYCw/s1600-h/image%255B41%255D"><img width="654" height="333" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[13](7).png" border="0" class="img-responsive"></a></figure><div class="bs-callout bs-callout-info"><p>      記得.Net Framework 4.6.2才有支援 .Net Standard 2.0嗎：<a href="http://immo.landwerth.net/netstandard-versions/#">http://immo.landwerth.net/netstandard-versions/#</a></p></div></dd><dd></dd><dt>      把程式run起來，發現執行結果和之前一樣     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-yFLhchvlrSs/Wd_9YXz5JPI/AAAAAAAAWlc/XWVsw51nFuwpOZbmWkTsSQc_Zy05rKZWACHMYCw/s1600-h/image%255B44%255D"><img width="654" height="431" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[14](4).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><section><h2 id="WizKMOutline_1507850726675745">建立一個.net core console使用建立出來的.Net Standard Lib</h2><dl><dt>      建立一個 .net core console 程式並且 reference 剛剛的 standard library     </dt><dd><figure><a href="https://lh3.googleusercontent.com/-ekMhHJh3m2U/Wd_9dLkcf2I/AAAAAAAAWlk/hDLF8W4RZo46i2iR5qm6ifZ2mC2khsg7ACHMYCw/s1600-h/image%255B47%255D"><img width="618" height="808" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[15](4).png" border="0" class="img-responsive"></a></figure></dd><dd></dd><dt>      最後執行結果 - 出現<em>錯誤</em></dt><dd><figure><a href="https://lh3.googleusercontent.com/--IrV_4yV68M/Wd_9jeytziI/AAAAAAAAWlw/hWac1SpIXFIFkdf_b100yovlLBgC2BYzQCHMYCw/s1600-h/image%255B50%255D"><img width="654" height="249" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[16](3).png" border="0" class="img-responsive"></a></figure><div class="bs-callout bs-callout-warning"><p>     這個錯誤是Visual Studio已知的一個bug，原因是VS在執行的時候Working Directory放在了sln的位置，而不是bin的路徑，造成相對路徑檔案會找不到      </p><p>     預計 VS 2017.6會修正。相關issue： <a href="https://github.com/dotnet/project-system/issues/2239">https://github.com/dotnet/project-system/issues/2239</a></p></div></dd><dd></dd><dt>      改成用<code>dotnet</code>執行     </dt><dd><ul><li>切換到bin下面</li><li>cmd執行：<code>dotnet NetCoreConsole.dll</code></li></ul><figure><a href="https://lh3.googleusercontent.com/-0OQd1EtVxKs/Wd_9orVJHHI/AAAAAAAAWl4/4CvYLygGNb8tsP5QLHF2vgRaU5jORECRQCHMYCw/s1600-h/image%255B53%255D"><img width="654" height="127" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-10-13-event-net-conf-workshop-03-1-port-net-framework-lib-to-net-standard_Asset/image_thumb[17](4).png" border="0" class="img-responsive"></a></figure></dd><dd></dd></dl></section><div class="bs-callout bs-callout-default"><p>    完整程式碼可以再github看到：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop">https://github.com/alantsai-samples/2017-10-14-net-core-workshop</a></p><p>    git標籤：<code>lab3/1-port-net-standard-finish</code></p><p>    兩種方式取得：     </p><ol><li>用git clone然後在checkout到<code>lab3/1-port-net-standard-finish</code></li><li>從github release下載：<a href="https://github.com/alantsai-samples/2017-10-14-net-core-workshop/releases/tag/lab3%2F1-port-net-standard-finish">下載鏈接</a></li></ol></div></section><section><h2 id="WizKMOutline_1507850726675682">參考資料</h2><dl><dt>     .Net Standard和Runtime版本對應    </dt><dd><a href="http://immo.landwerth.net/netstandard-versions/#">http://immo.landwerth.net/netstandard-versions/#</a></dd><dd></dd><dt>     .Net Api Browser - 檢查api支援度    </dt><dd><a href="https://docs.microsoft.com/zh-tw/dotnet/api/?view=netstandard-2.0">https://docs.microsoft.com/zh-tw/dotnet/api/?view=netstandard-2.0</a></dd><dd></dd><dt>     官方介紹port到standard建議執行方式    </dt><dd><a href="https://docs.microsoft.com/en-us/dotnet/core/porting/">https://docs.microsoft.com/en-us/dotnet/core/porting/</a></dd><dd></dd></dl></section><section>   <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:76204883-3d49-406b-9f7e-7ed32c1b684e" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c.Net+Core+%e8%88%87+.Net+Standard+%e5%af%a6%e6%88%b0%e6%95%99%e5%ad%b8%e3%80%8d" rel="tag">「.Net Core 與 .Net Standard 實戰教學」</a>,<a href="/tags/net-core" rel="tag">net-core</a>,<a href="/tags/lab" rel="tag">lab</a>,<a href="/tags/net-standard" rel="tag">net-standard</a></div></section>