Title: "[從.Net工程師的角度來看DevOps 25]在Visual Studio Team Services執行Build Script和CI Server總結"
Published: 2017-12-16
Modified: 2018-02-11
Image: /posts/migrate/2017-12-16-devopsSeries-integrate-build-script-in-visual-studio-team-service_Asset/image_thumb(59).png
Tags: ["「ithome 第八屆鐵人賽」","devops","「從.net工程師的角度來看devops」"]
RedirectFrom: 2017/12/devopsSeries-integrate-build-script-in-visual-studio-team-service.html
Series: ["「iThome 第八屆鐵人賽」","「從.Net工程師的角度來看DevOps」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-F0eQpjkMr4g/WjSBckzq-OI/AAAAAAAAXHw/qWznbo6H1sUhmLgbsXMRxNca7xYgdhF6QCHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-16-devopsSeries-integrate-build-script-in-visual-studio-team-service_Asset/image_thumb(59).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/books-spine-colors-pastel-1099067/ 和 https://blog.xebialabs.com/2016/03/21/essential-devops-terms/</figcaption><br></figure></section><section><p>在上一篇（<a href="http://blog.alantsai.net/2017/12/devopsSeries-intro-to-free-ci-service-visual-studio-team-services.html">[從.Net工程師的角度來看DevOps 24]免費build私人Repo的CI Service - Visual Studio Team Service介紹</a><span style="line-height: 1.6;">）了解了如何用Visual Studio Team Services（VSTS）的內建Template來build範例專案；在設定的過程，其實沒辦法直接使用內建template，會需要調整一些參數。</span></p><p>這些調整的內容和AppVeyor要調整的非常不一樣，造成了如果要換CI Server會花一些時間在這些瑣碎的細節上面。   </p><p>這篇將會看看，如果要把VSTS改成用build script來build專案，會需要做些什麼。   </p></section>   <section>    <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6;" href="#WizKMOutline_1513390188874937" ;="">調整VSTS來執行build script</a><br></li><li><a style="line-height: 1.6;" href="#WizKMOutline_1513390188874477" ;="">簡單總結CI Server和build script的關係</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6;" href="#WizKMOutline_1513390188874300" ;="">每個CI Server設定方式都不同</a><br></li><li><a style="line-height: 1.6;" href="#WizKMOutline_1513390188874403" ;="">拿不到build完的內容 - Artifact</a><br></li></ul><li><a style="line-height: 1.6;" href="#WizKMOutline_1513390188874907" ;="">結語</a><br></li></ul></div></section>     <a name="more"></a>  <section><h2 id="WizKMOutline_1513390188874937">調整VSTS來執行build script</h2><p>首先，先建立一個新的build definition，這次在template的部分選擇empty template：   </p><figure><a href="https://lh3.googleusercontent.com/-7AKTaUVB4wU/WjSBe_HtgrI/AAAAAAAAXH4/IAUI6utc4fEqKL7Vgy1AK5KOY98mOMF5wCHMYCw/s1600-h/image%255B5%255D"><img width="654" height="312" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-16-devopsSeries-integrate-build-script-in-visual-studio-team-service_Asset/image_thumb[1](53).png" border="0" class="img-responsive"></a><br><figcaption>選擇emptytemplate</figcaption></figure><p>進來了之後，只需要加入一個powershell script的step並且指向專案裡面的build script，並且選擇<code>Save &amp; Queue</code></p><figure><a href="https://lh3.googleusercontent.com/-vApS2e2K6yE/WjSBg9unUyI/AAAAAAAAXIA/11fO-OBYxx85shUap2HirvXJ_3H-ieaLgCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="269" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-16-devopsSeries-integrate-build-script-in-visual-studio-team-service_Asset/image_thumb[2](43).png" border="0" class="img-responsive"></a><br><figcaption>設定powershell script</figcaption></figure><div class="bs-callout bs-callout-warning">這邊要注意在step前面的<code>Get Sources</code>需要設定和github連上。   </div><p>之後build就會開始，並且跑完了之後可以看到log資訊和我們在local執行的時候是一樣的內容：   </p><figure><a href="https://lh3.googleusercontent.com/--EO_gAymUEY/WjSBjLn4m4I/AAAAAAAAXII/kDWO7o726X0TeLhC39CVqmEe5vR8yCYVQCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="374" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-16-devopsSeries-integrate-build-script-in-visual-studio-team-service_Asset/image_thumb[3](40).png" border="0" class="img-responsive"></a><br><figcaption>執行完的結果</figcaption></figure></section><section><h2 id="WizKMOutline_1513390188874477">簡單總結CI Server和build script的關係</h2><p>目前為止，看了兩個CI Server：AppVeyor和VSTS。在這裡面會發現2個問題：   </p><ol><li>每個CI Server設定方式都不同</li><li>拿不到build完的內容 - Artifact</li></ol><section><h3 id="WizKMOutline_1513390188874300">每個CI Server設定方式都不同</h3><p>在AppVeyor，已經幫使用者區分好build、test、deploy等等階段，只需要設定這些階段要執行什麼，AppVeyor就會建制完。    </p><p>在VSTS則是用step的概念，由使用者自己定義每一個階段要執行什麼，然後有一些已經定義好符合某些專案的template，方便快速設定。    </p><p>可以想象每一種CI Server有自己的設計理念，如果今天沒有build script要設定每一個CI Server其實很麻煩，尤其是當CI Server更新版本的時候，位置和內容可能都會不一樣，需要花時間再去研究。    </p><p>反過來說，如果把build邏輯都整合到build script，<em>不止不會被綁到某一個CI Server</em>，並且不管在哪一個CI Server只需要執行那個build script即可，並且build script在做什麼非常清楚，    不像如果依賴CI Server，不能夠肯定裡面到底執行了什麼操作。    </p></section><section><h3 id="WizKMOutline_1513390188874403">拿不到build完的內容 - Artifact</h3><p>當程式碼build完之後，一定會有一個產出，例如library會是一個dll，這種產出在CI有個名稱叫做<em><strong>Artifact</strong></em>。    </p><p>如果眼尖的朋友，會注意到，如果用CI內建的方法，<em>會產生出Artifact</em>，但是執行build script <em>會沒有</em>。    </p><figure><a href="https://lh3.googleusercontent.com/-HTF9yNAf8d8/WjSBlyZ7ttI/AAAAAAAAXIQ/i9xABTVSLhMq1lmsvrDvjlULylIkBsi_gCHMYCw/s1600-h/image%255B14%255D"><img width="654" height="285" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/posts/migrate/2017-12-16-devopsSeries-integrate-build-script-in-visual-studio-team-service_Asset/image_thumb[4](40).png" border="0" class="img-responsive"></a><br><figcaption>VSTS內建template build的結果，artifact有東西</figcaption></figure><p>並且build過程有些資訊，像是測試情況、測試涵蓋率（Code Coverage）這些在自己的build script也會看不到。這是因為目前build script還沒有結合CI Server，這也是接下來需要補強的部分。    </p></section></section><section><h2 id="WizKMOutline_1513390188874907">結語</h2><p>目前build script基本已經完成了，但是如果沒辦法自動打包產出結果，對於發佈和整個CI效用就大打折扣了。   </p><p>因此，接下來將會開始進入另外一個階段，<em><strong>Package</strong></em>的階段。   </p><p>而在package裡面，有個非常重要的概念是版號（Version），因此下篇將會介紹版號的重要性。   </p></section><section>    <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:cc7172eb-09ca-44fd-a0ad-a88c5c1580fa" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c%e5%be%9e.Net%e5%b7%a5%e7%a8%8b%e5%b8%ab%e7%9a%84%e8%a7%92%e5%ba%a6%e4%be%86%e7%9c%8bDevOps%e3%80%8d" rel="tag">「從.Net工程師的角度來看DevOps」</a>,<a href="/tags/%e3%80%8ciThome+%e7%ac%ac%e5%85%ab%e5%b1%86%e9%90%b5%e4%ba%ba%e8%b3%bd%e3%80%8d" rel="tag">「iThome 第八屆鐵人賽」</a>,<a href="/tags/devops" rel="tag">devops</a>,<a href="/tags/.net" rel="tag">.net</a></div></section>