Title: "[打造自己的template-建立一致性程式碼][07]匯出template建立小總結，更好的建立方式介紹 VSIX"
Published: 2017-09-02
Modified: 2017-09-02
Image: /posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb(30).png
Tags: ["visual studio","「打造自己的template-建立一致性程式碼」"]
RedirectFrom: 2017/09/buildYourOwnTemplate-create-item-template.html
Series: ["「打造自己的template-建立一致性程式碼」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-RufUA8c1yjU/WapccBmGIcI/AAAAAAAAWPg/6pkcat7zvQoLwWwM3cOThERX1DQiqmHDgCHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="匯出template建立小總結，更好的建立方式介紹 VSIX" style="display: inline; background-image: none;" alt="匯出template建立小總結，更好的建立方式介紹 VSIX" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb(30).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/annual-report-book-brochure-686343/</figcaption></figure><p>  在上一篇（<a href="http://blog.alantsai.net/2017/08/buildYourOwnTemplate-create-item-template.html">[06]建立Item Template</a>）介紹完了Item Template的建立方式之後，基本上關於template建立方式的介紹就結束了。剩下只是透過介紹的內容微調自己的template達到想要的目標。   </p><p>  Template建立方式講完了，但是另外一個問題出現了，這種建立出來的template在管理上面非常的不方便，例如沒有版控，安裝還要到特定位置等，是否有什麼方式可以讓管理變得更加簡單嗎？   </p></section><section><div class="bs-callout bs-callout-default">匯出用的範例程式碼 <a href="https://github.com/alantsai-samples/mhat-visualstudio-template/releases/tag/sample%2Fchapter07">github mhat-visualstudio-template sample/chapter07</a></div></section>   <section> <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310442958" ;="">匯出Template的方式管理問題是什麼</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310442754" ;="">使用建立Project Template的專案</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310442224" ;="">整合之前的專案到Project Tempalte專案</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443750" ;="">了解專案的特殊之處</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443867" ;="">vstemplate的buildAction</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443772" ;="">cs檔案不會被建制</a><br></li></ul></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443594" ;="">更簡單的安裝方式 - VSIX</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443748" ;="">1. 建立一個VSIX的Project</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443883" ;="">2. 設定VSIX包含Project Template專案</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443933" ;="">3. 測試</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1504336310443617" ;="">結語</a><br></li></ul></div></section>    <a name="more"></a> <section><h2 id="WizKMOutline_1504336310442958">匯出Template的方式管理問題是什麼</h2><p>  在這幾篇文章介紹匯出Template的時候，會注意到範例程式碼只是提供run起來的版本，要變成template還是需要自己透過匯出的方式。   </p><p>  難道沒有什麼方式可以讓他像一般專案一樣，只有在建立的時候在建立成為zip檔案嗎？   </p><p>  另外一個問題，要安裝這個template需要把zip放到對應的資料夾才會出現。   </p><p>  難道不能夠像安裝軟體那樣安裝嗎？還有如果要更新template怎麼管控這些template？   </p><p>  總結起來說大概有這幾個問題：   </p><ul><li>如何版控template？</li><li>如何更容易更新template？</li><li>如何更容易安裝template？</li></ul><p>  這些問題其實已經有被發現，因此有所謂的建立<code>Project Template</code>用的Project和用安裝一般VS套件的方式來裝tempalte。   </p></section><section><h2 id="WizKMOutline_1504336310442754">使用建立Project Template的專案</h2><p>  這個標題有點饒舌，不過意思是在Visual Studio（統稱VS）裡面其實有一個特殊的Template，專門用來建立Template的，不過要使用之前，會需要安裝<code>Visual Studio SDK</code></p><div class="bs-callout bs-callout-info">   Visual Studio SDK在2015版本之後都是和VS一起安裝的時候可以選的一個選項。    <figure><figcaption><a href="https://lh3.googleusercontent.com/-WpDH4_Uq0J8/Wapce_nSW9I/AAAAAAAAWPo/6l-wDr0nWdUaEYJiV1v_oqW31BLzCyi3gCHMYCw/s1600-h/image%255B5%255D"><img width="496" height="571" title="VS 2015的安裝選項" style="display: inline; background-image: none;" alt="VS 2015的安裝選項" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[1](27).png" border="0" class="img-responsive"></a></figcaption><figcaption>VS 2015的安裝選項 - 截圖取自於：<a href="https://msdn.microsoft.com/zh-tw/library/mt683786.aspx">https://msdn.microsoft.com/zh-tw/library/mt683786.aspx</a></figcaption></figure><figure><figcaption><a href="https://lh3.googleusercontent.com/-kdPQ0THz6JI/WapcgxwgpMI/AAAAAAAAWPw/dTZoZ6pbjl0Fjy-ssYwhXN9951hvWHEWgCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="334" title="VS 2017的安裝選項" style="display: inline; background-image: none;" alt="VS 2017的安裝選項" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[2](21).png" border="0" class="img-responsive"></a></figcaption><figcaption>VS 2017的安裝選項 - 截圖取自於：https://blogs.msdn.microsoft.com/devops/2016/12/12/the-visual-studio-modeling-sdk-is-now-available-with-visual-studio-2017/</figcaption></figure></div><p>  安裝好之後，在VS建立新的專案會發現有個分類叫做<code>Extensibility</code> -&gt; <code>C# Project Template</code></p><figure><a href="https://lh3.googleusercontent.com/-K9iufyIPUnc/WapcjJHYydI/AAAAAAAAWP4/buMMQ0niVNwQwTGUbWXni_gTC0eFcqHCQCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="375" title="建立Project Template" style="display: inline; background-image: none;" alt="建立Project Template" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[3](18).png" border="0" class="img-responsive"></a><figcaption><a href="https://lh3.googleusercontent.com/-0OHHgL66DHs/WapcnMN4x1I/AAAAAAAAWQA/_jKzyBwaKrQhFG8TQ8UQsMflF-rGwyNwACHMYCw/s1600-h/image%255B14%255D"><img width="469" height="421" title="建立出來的ProjectTemplate範本內容" style="display: inline; background-image: none;" alt="建立出來的ProjectTemplate範本內容" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[4](18).png" border="0" class="img-responsive"></a><br></figcaption><figcaption>Project Template的位置</figcaption></figure><p>  建立出來之後，會發現和一般的Project差不多，不過看到熟悉的<code>vstemplate</code>檔案，並且build之後會發現release那邊有一個zip檔案被產生出來。   </p><figure><a href="https://lh3.googleusercontent.com/-T0FJsfvnP_Y/WapcsgvfQDI/AAAAAAAAWQI/sCaKQWHY3k4s1W8d36xaPYdlXT5IHzVjgCHMYCw/s1600-h/image%255B17%255D"><img width="654" height="236" title="build產生的內容" style="display: inline; background-image: none;" alt="build產生的內容" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[5](11).png" border="0" class="img-responsive"></a><br><figcaption>build之後的內容</figcaption></figure></section><section><h2 id="WizKMOutline_1504336310442224">整合之前的專案到Project Tempalte專案</h2><p>  既然有了更好的產生zip檔案的方式，可以把之前<em>匯出</em>的zip檔案內容解壓縮出來然後加入到建立出來的Project Template。   </p><p>  不過在做這件事情之前，要先了解一下這個專案的不同之處。   </p><section><h3 id="WizKMOutline_1504336310443750">了解專案的特殊之處</h3><p>  這個專案有幾個特別之處：   </p><ol><li><code>vstemplate</code>檔案的<code>buildAction</code>是<code>VSTemplate</code></li><li><code>cs</code>檔案不會被建制</li></ol><section><h4 id="WizKMOutline_1504336310443867">vstemplate的buildAction</h4><p>  如果對<code>VSIXSingProjectTemplate.vstemplate</code>點<kbd>右鍵</kbd>然後選擇<code>Properties</code>：   </p><div class="bs-callout bs-callout-info">   也可以選到 <code>VSIXSingProjectTemplate.vstemplate</code>之後，安縣鍵盤的<kbd>F4</kbd>來開啟   </div><p>  在Property視窗可以看到<code>BuildAction</code>的值是<code>VSTemplate</code></p><figure><a href="https://lh3.googleusercontent.com/-yvMhnCpjEz0/Wapcv88kdOI/AAAAAAAAWQQ/fGfKfjEhz-8cE5e6E4raE9bdn5Zr-dYZACHMYCw/s1600-h/image%255B20%255D"><img width="654" height="570" title="buildAction 不同之處" style="display: inline; background-image: none;" alt="buildAction 不同之處" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[6](8).png" border="0" class="img-responsive"></a><br><figcaption>1. 選了檔案，2. 用右鍵或者F4開啟 3. 的property然後看到4. 的property視窗</figcaption></figure><p>  這個其實就是特別之處，告訴VS在build的時候要觸發zip這個動作。   </p><p>  所以，在把匯出的template整合進來的時候，<em><strong>要把vstemplate的<code>BuildAction</code>改成<code>VSTemplate</code> </strong></em></p></section></section><section><h4 id="WizKMOutline_1504336310443772">cs檔案不會被建制</h4><p>   如果對cs檔案點右鍵，然後選擇<code>Property</code>，會發現他們的的<code>buildAction</code>會是<code>None</code></p><figure><a href="https://lh3.googleusercontent.com/-ib9TcUgrGvw/WapcyIQ9uLI/AAAAAAAAWQY/7JTAhBw_9bwCGMbbzGRlJ99JXATDSxj3gCHMYCw/s1600-h/image%255B23%255D"><img width="606" height="421" title="把buildAction改成none" style="display: inline; background-image: none;" alt="把buildAction改成none" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[7](6).png" border="0" class="img-responsive"></a><br><figcaption>buildAction為none</figcaption></figure><p>   所以，記得等一下整合匯出的cs檔案要設定<code>buildAction</code>為<code>None</code></p></section><p>  最後整合好的template看起來如下圖：   </p><figure><a href="https://lh3.googleusercontent.com/-XazYisbySts/Wapc7yYhJXI/AAAAAAAAWQg/HxszknPeUsoyb4lNRcl7JXSg3ERHAfVrACHMYCw/s1600-h/image%255B26%255D"><img width="368" height="439" title="最後專案的樣子" style="display: inline; background-image: none;" alt="最後專案的樣子" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[8](7).png" border="0" class="img-responsive"></a><br><figcaption>最後的樣子</figcaption></figure></section><section><h2 id="WizKMOutline_1504336310443594">更簡單的安裝方式 - VSIX</h2><p>  建立出zip檔案之後，還是需要自己手動搬移其實還是很麻煩。   </p><p>  這個時候可以搭配建立一個VSIX（VS的擴充套件的專案類型）來讓安裝template更加簡單。          </p><p>  建立方式如下：   </p><ol><li>建立一個VSIX的Project</li><li>設定VSIX包含Project Template專案</li><li>測試</li></ol><section><h3 id="WizKMOutline_1504336310443748">1. 建立一個VSIX的Project</h3><p>  在Project Template專案那個Solution裡面在加入一個專案，不過這次建立的是一個<code>VSIX Project</code></p><figure><a href="https://lh3.googleusercontent.com/-RMPANDIupBU/Wapc9uXZIfI/AAAAAAAAWQo/PUSzRUpM_dEvEjuFsTUOcJVijEpDgSj5gCHMYCw/s1600-h/image%255B29%255D"><img width="654" height="375" title="建立VSIX專案" style="display: inline; background-image: none;" alt="建立VSIX專案" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[9](2).png" border="0" class="img-responsive"></a><br><figcaption>VSIX專案</figcaption></figure><p>  可以對建立出來的<code>source.extension.vsixmanifest</code>點兩下，然後會開出一個設定的畫面。   </p><p>  可以先設定一些這個套件你的相關資訊。   </p><figure><a href="https://lh3.googleusercontent.com/-ofXh9mWontc/WapdA7rKY1I/AAAAAAAAWQw/ZfHCghTG4oY3NL5Ccl1Cj1wNJdPLbNI6ACHMYCw/s1600-h/image%255B34%255D"><img width="654" height="262" title="套件基本資訊" style="display: inline; background-image: none;" alt="套件基本資訊" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[12](3).png" border="0" class="img-responsive"></a><br><figcaption>基本資訊的設定</figcaption></figure></section><section><h3 id="WizKMOutline_1504336310443883">2. 設定VSIX包含Project Template專案</h3><p>   設定好這個套件相關資訊之後，一樣還是<code>source.extension.vsixmanifest</code>的設定裡面：    </p><ol><li>選擇 <code>Assets</code></li><li>選擇右邊的<kbd>News</kbd></li><li><code>Type</code>選擇<code>Microsoft.VisualStudio.ProjectTemplates</code></li><li><code>Source</code>選擇<code>A Project in solution</code></li><li><code>Project</code>選擇 上面建立的那個Project Template專案</li><li>按下 <kbd>OK</kbd></li></ol><a href="https://lh3.googleusercontent.com/-P5KbNp9TT9o/WapdDDj5BhI/AAAAAAAAWQ4/tCshQr2h7c8pv2diBk6MHARCP0ezd1xWACHMYCw/s1600-h/image%255B37%255D"><img width="654" height="211" title="加入一個Assets" style="display: inline; background-image: none;" alt="加入一個Assets" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[13](3).png" border="0" class="img-responsive"></a><figure><a href="https://lh3.googleusercontent.com/-1a72zgae-Pg/WapdFygWs_I/AAAAAAAAWRA/eaZvCZrstlswMoYweyPosqvheL4nAJu3ACHMYCw/s1600-h/image%255B40%255D"><img width="654" height="559" title="選擇Project Template" style="display: inline; background-image: none;" alt="選擇Project Template" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[14](2).png" border="0" class="img-responsive"></a><br><figcaption>相關設定的截圖</figcaption></figure></section><section><h3 id="WizKMOutline_1504336310443933">3. 測試</h3><p>   先把 VSIX 專案設定為<code>Startup Project</code></p><figure><a href="https://lh3.googleusercontent.com/-7iLFY9ORAiA/WapdNU12TmI/AAAAAAAAWRI/bqUX5FR-d7wMMqrEv1AvdmunUVIdnWUoQCHMYCw/s1600-h/image%255B43%255D"><img width="654" height="427" title="選擇為起始專案" style="display: inline; background-image: none;" alt="選擇為起始專案" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[15](2).png" border="0" class="img-responsive"></a><br><figcaption>設定 startup project</figcaption></figure><p>   這個時候把專案Run起來，等一下之後，VS會開啟一個<code>Experimental Instance</code>的版本。    </p><p>   在這個VS裡面，新增 專案的時候會看到剛剛建立的Template，嘗試建立出來測試是否符合需求。    </p><figure><a href="https://lh3.googleusercontent.com/--dAT6B78kSo/WapdRR47LTI/AAAAAAAAWRQ/rSiqCVIRy2EfF5btuqTYVJ7atG6Y4PmWwCHMYCw/s1600-h/image%255B46%255D"><img width="654" height="364" title="自動啟動Experimental Instance並且template存在" style="display: inline; background-image: none;" alt="自動啟動Experimental Instance並且template存在" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[16](2).png" border="0" class="img-responsive"></a><br><figcaption>可以看到名稱會加入一個<code>Experimental Instance</code>的字，並且在新增 專案 看到剛剛那個template</figcaption></figure></section><p>  最後，如果都確認沒有問題之後，想要給另外一台電腦或者實際在開發的VS裝上template，可以把VSIX專案bin裡面的VSIX檔案取出來，點兩下去做安裝。   </p><figure><a href="https://lh3.googleusercontent.com/-2TF6U-foc9E/WapdTdL6H_I/AAAAAAAAWRY/vSuXQwHtnw0_6_sCqrR2f5d5xJwEBxNsACHMYCw/s1600-h/image%255B49%255D"><img width="654" height="139" title="可安裝的VSIX檔案" style="display: inline; background-image: none;" alt="可安裝的VSIX檔案" src="/posts/migrate/2017-09-02-buildYourOwnTemplate-create-item-template_Asset/image_thumb[17](3).png" border="0" class="img-responsive"></a><br><figcaption>最後產生出的VSIX</figcaption></figure></section><secction><h2 id="WizKMOutline_1504336310443617">結語</h2><p> 這篇了解了如何透過使用Project Template專案搭配VSIX專案來讓管理和安裝變得更加的簡單；讓整個template可以被版控和容易安裝。  </p><p> 在下一篇會對於VS的Experimental Instance做一些介紹，讓未來在debug template的時候更加簡單，和一些Project Template專案和匯出template不同之處的細節設定（例如如何設定<code>分類</code>）。  </p></secction> <section> <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:11690d93-c373-406c-b7fa-7fcf659c60fc" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c%e6%89%93%e9%80%a0%e8%87%aa%e5%b7%b1%e7%9a%84template-%e5%bb%ba%e7%ab%8b%e4%b8%80%e8%87%b4%e6%80%a7%e7%a8%8b%e5%bc%8f%e7%a2%bc%e3%80%8d" rel="tag">「打造自己的template-建立一致性程式碼」</a>,<a href="/tags/Visual+Studio" rel="tag">Visual Studio</a></div></section>