Title: "[Entity Framework] 如何在Database Designer把一個int欄位轉成Enum形態 (Entity Framework Convert int to Enum)"
Published: 2014-12-05
Modified: 2014-12-26
Image: /posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb(85).png
Tags: ["entity framework"]
RedirectFrom: 2014/12/entity-framework-database.html
Series: []
---
<a id="KMContentPageTopID" name="KMContentPageTopID"></a> <div id="divKMOutline" style="border-top-style: groove; border-bottom-style: groove; border-right-style: none; margin: 10px 0px; border-left-style: none"> <ul style="margin: 0px 0px 0px 20px"> <li><a href="#WizKMOutline_1417793386927429" ;="">前言</a>  </li><li><a href="#WizKMOutline_1417793386927439" ;="">範例的環境設定</a>  </li><li><a href="#WizKMOutline_1417793386927905" ;="">設定把int轉成enum</a>  </li><li><a href="#WizKMOutline_1417793386927895" ;="">當DB table重新建立的時候，在設定成為enum形態遇到的問題</a>  </li><li><a href="#WizKMOutline_1417793386927419" ;="">int轉Enum的原理</a>  </li><li><a href="#WizKMOutline_1417793386927451" ;="">解決方法</a>  </li><li><a href="#WizKMOutline_1417793386927719" ;="">結論</a></li></ul></div> <h1 id="WizKMOutline_1417793386927429">前言</h1> <p>enum其實內部儲存的形態還是int，所以任何一個int都可以直接cast成為某一個enum type，這樣就可以用那個enum的形態來操作這些值，在撰寫和閱讀程式上面就會變得比較乾淨和一目了然。 </p> <p>Entity Framework在Code First模式下要定義一個enum非常的簡單，只需要把type設定成為那個enum，Entity Framework就會聰明到把DB的對應欄位開成int，並且儲存和讀取的時候幫忙自動轉換。 </p> <p>但是當使用Database First模式的時候，因為Designer從DB讀取回來只會把int當做int，因此要他自動產出enum是需要做一些設定。 </p> <p>這一篇將會介紹把int轉成enum如何做到，並且需要注意那些地方。 </p><a name="more"></a> <h1 id="WizKMOutline_1417793386927439">範例的環境設定</h1> <p>我們會用一個簡單的Database，裡面只有一個Table叫做<code>Post</code>，代表每一筆部落格裡面的文章。 </p> <p>在裡面有個欄位叫做<code>Status</code>表示目前這篇文章的狀態，就是今天我們要來看的int轉enum的欄位。 </p><figure><a href="http://lh6.ggpht.com/-mBkAOQdBClI/VIHRSyl5-cI/AAAAAAAAOQA/vwhy6Sfyc3k/s1600-h/image%25255B2%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb(85).png" width="239" height="120" class="img-responsive"></a> <figcaption>Post table所擁有的欄位</figcaption> </figure> <p>再來，我們在程式裡面，定義一個enum叫做<code>status</code>，這個定義是用來和DB裡面的int做對應。 </p><pre class="brush: csharp;"><code class="language-csharp line-numbers">namespace ConsoleApplication1
{
    public enum Status
    {
        草稿,
        已發佈,
        已刪除
    } 
}
  </code></pre><br><h1 id="WizKMOutline_1417793386927905">設定把int轉成enum</h1><br><p>把int轉成enum其實非常的簡單，只需要打開我們的<code>.edmx</code>然後找到要轉換的欄位 <a href="http://lh5.ggpht.com/-B1iCY9HhNuw/VIHRUhTdh5I/AAAAAAAAOQQ/yY-6qRr7HCw/s1600-h/image%25255B7%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[3](57).png" width="224" height="225" class="img-responsive"></a><br></p><figcaption>打開edmx</figcaption> <p></p><br><p>對他點<kbd>右鍵</kbd>然後會看到有個選項是：<kbd>Convert To Enum</kbd> </p><figure><a href="http://lh6.ggpht.com/-U0AI-oykR44/VIHRXR3vLWI/AAAAAAAAOQg/I_4TAs5uRwE/s1600-h/image%25255B11%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[5](40).png" width="233" height="212" class="img-responsive"></a><br><figcaption>開啟Convert To Enum的畫面</figcaption> </figure><br><p>這個時候就會看到新增Enum的畫面。這邊有兩個欄位我有設定： </p><br><ol><br><li>Enum Type Name：這個Enum要命名的名稱 <br></li><li>Reference External Type： 如果我們別的地方已經有定義了要用的enum，可以直接輸入他的Fully Qualified Name，那麼就會自動對應。<em>需要注意，如果輸入錯誤，那麼產生出來的type也會錯</em>。 </li></ol><br><div class="bs-callout bs-callout-info">其實如果外部沒有定義過enum，也可以透過這個介面直接定義enum內容。 </div><figure><a href="http://lh4.ggpht.com/-MQw8xUE3D_I/VIHRZ9C_-XI/AAAAAAAAOQw/KwaL-_Ps-JA/s1600-h/image%25255B18%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[10](13).png" width="303" height="288" class="img-responsive"></a><br><figcaption>設定enum畫面</figcaption> </figure><br><p>設定完了之後，產生出來的class檔案如下： </p><figure><a href="http://lh5.ggpht.com/-F41bg64NMAc/VIHRcCo_CVI/AAAAAAAAORA/YjIKGcoE83E/s1600-h/image%25255B22%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[12](19).png" width="408" height="232" class="img-responsive"></a><br><figcaption>最後產生出來的Class</figcaption> </figure><br><h1 id="WizKMOutline_1417793386927895">當DB table重新建立的時候，在設定成為enum形態遇到的問題</h1><br><p>把int轉成enum其實很簡單，但是如果對於背後的機制不瞭解的話，就會遇到這個處理不了的情況。 </p><br><p>假設，今天我們把這個<code>Post</code>Class刪掉了，然後又從新加回來。這個時候，會發現<code>Status</code>欄位會變回<code>int</code>。這個時候我們再用一樣 的方式把<code>int</code>轉成enum，會發現會有問題： </p><figure><a href="http://lh5.ggpht.com/-vGnz7tWMJ1I/VIHRemdNcUI/AAAAAAAAORQ/XqUJOFu-Suc/s1600-h/image%25255B28%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[16](5).png" width="284" height="265" class="img-responsive"></a><br><figcaption>無法轉換</figcaption> </figure><br><p>這個時候會發現完全沒有辦法在新增一筆，這個到底是爲什麽呢？ </p><br><h1 id="WizKMOutline_1417793386927419">int轉Enum的原理</h1><br><p>後來在思考一下，其實不管enum是由外部reference的還是直接透過ui建立enum值，其實<code>edmx</code>都會記錄。 </p><br><p>我們可以從Visual Studio的<code>Entity Data Model Browser</code>來開啟看看edmx有的內容。這個時候應該會看到<code>Model</code>下面的<code>Enum Types</code>有一筆剛剛建立的<code>Status</code> </p><figure><a href="http://lh4.ggpht.com/-TB-njpF1hcE/VIHRhZDhgFI/AAAAAAAAORg/XB5fBXUzVHo/s1600-h/image%25255B38%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[22](3).png" width="247" height="245" class="img-responsive"></a><a href="http://lh6.ggpht.com/-HtJPekhQly0/VIHRlYGPYNI/AAAAAAAAORw/03T04FqHTHs/s1600-h/image%25255B37%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[21](4).png" width="213" height="240" class="img-responsive"></a></figure><figure><figcaption>開啟Entity Data Model Browser</figcaption> </figure><br><div class="bs-callout bs-callout-default">當我們在把int轉換成為enum的時候，給的<code>Enum type name</code>其實就是定義的enum名稱，而edmx是認得這個名字而已，而不認得其他。 </div><br><div class="bs-callout bs-callout-info">其實edmx裡面總共會記錄3種資訊，其實我以前曾經介紹entity framework的power point有提到過，但是久了自己都忘記了：<iframe style="margin-bottom: 5px; max-width: 100%; border-top: #ccc 1px solid; border-right: #ccc 1px solid; border-bottom: #ccc 1px solid; border-left: #ccc 1px solid" height="355" marginheight="0" src="//www.slideshare.net/slideshow/embed_code/37067587?startSlide=9" frameborder="0" width="425" marginwidth="0" scrolling="no" allowfullscreen=""> </iframe> <br><div style="margin-bottom: 5px"><strong><a title="Entity framework + Linq 介紹" href="//www.slideshare.net/alantsai2007/entity-framework-linq" target="_blank" rel="noopener">Entity framework + Linq 介紹</a> </strong>from <strong><a href="//www.slideshare.net/alantsai2007" target="_blank" rel="noopener">Alan Tsai</a></strong> </div></div><br><h1 id="WizKMOutline_1417793386927451">解決方法</h1><br><p>既然我們知道edmx只認得它內部看的懂得形態，這個時候我們就可以透過ui去選擇欄位的形態，這個時候就會發現我們建立的enum： </p><figure><a href="http://lh4.ggpht.com/-xWPEkeFYqTE/VIHRnouA40I/AAAAAAAAOSA/tskHf4jKg9E/s1600-h/image%25255B45%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[27](2).png" width="296" height="288" class="img-responsive"></a><a href="http://lh5.ggpht.com/-oJ887E3xLpE/VJ1x99k08dI/AAAAAAAAOUs/JHyy5ZAITBg/s1600-h/image%25255B4%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/posts/migrate/2014-12-05-entity-framework-database_Asset/image_thumb[2](61).png" width="226" height="205" class="img-responsive"></a><br><figcaption>設定欄位形態</figcaption> </figure><br><h1 id="WizKMOutline_1417793386927719">結論</h1><br><p>其實int轉enum看似簡單，裡面有很多細節。而這些細節有時候看一篇教學文章是不會講到的內容，造成在實務上面使用的時候，一出現問題很不容易解決。 </p><br><p>因此，有時候還真需要靜下心來瞭解背後的原理，才知道如何解決。 </p>  