Title: "[打造自己的template-建立一致性程式碼][05]建立多專案(multi project)的Template"
Published: 2017-08-29
Modified: 2017-08-29
Image: /posts/migrate/2017-08-29-buildYourOwnTemplate-create-multi-project-template_Asset/image_thumb(28).png
Tags: ["visual studio","「打造自己的template-建立一致性程式碼」"]
RedirectFrom: 2017/08/buildYourOwnTemplate-create-multi-project-template.html
Series: ["「打造自己的template-建立一致性程式碼」"]
---
<section><figure><a href="https://lh3.googleusercontent.com/-UTRqHogw9u8/WaRMnLMbGiI/AAAAAAAAWM8/s_U_39GWgigoFhGkaGqtw2cwqZW9UW04ACHMYCw/s1600-h/image%255B2%255D"><img width="654" height="290" title="[打造自己的template-建立一致性程式碼][05]建立多專案(multi project)的Template" style="display: inline; background-image: none;" alt="[打造自己的template-建立一致性程式碼][05]建立多專案(multi project)的Template" src="/posts/migrate/2017-08-29-buildYourOwnTemplate-create-multi-project-template_Asset/image_thumb(28).png" border="0" class="img-responsive"></a><br><figcaption>圖片來源：https://pixabay.com/en/annual-report-book-brochure-686343/</figcaption></figure></section><section><p>在上篇<a href="http://blog.alantsai.net/2017/08/buildYourOwnTemplate-understand-vstemplate-make-vs-refresh-template-cache.html">[04]了解vstemplate來微調匯出的Template和強制VS更新Template的方式</a>   了解了project template的最重要檔案，<code>vstemplate</code>並且了解了如何微調匯出的Template。   </p><p>在這一篇將會在了解如何調整<code>vstemplate</code>來建立多Project（multi project）的Project Template。   </p></section><section><div class="bs-callout bs-callout-default">範例程式碼 <a href="https://github.com/alantsai-samples/mhat-visualstudio-template/releases/tag/sample%2Fchapter05">github mhat-visualstudio-template sample/chapter05</a></div></section>   <section> <a name="KMContentPageTopID" id="KMContentPageTopID"></a><div id="divKMOutline" style="border-style: groove none; margin: 10px 0px;"><ul style="margin: 0px 0px 0px 20px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015912651" ;="">為什麼會需要Multi Project Template</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913400" ;="">建立Multi Project的情境</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913990" ;="">建立Multi Project Template</a><br></li><ul style="margin: 0px 0px 0px 30px;"><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913235" ;="">先把兩個project用匯出的方式匯出Project Template</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913682" ;="">建立出multi project template的資料夾結構</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913464" ;="">整個打包zip</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913354" ;="">放到對應路徑</a><br></li></ul><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913225" ;="">測試最後結果</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913264" ;="">結語</a><br></li><li><a style="line-height: 1.6; font-size: 15px;" href="#WizKMOutline_1503939015913640" ;="">參考資料</a><br></li></ul></div></section>     <a name="more"></a> <section><h2 id="WizKMOutline_1503939015912651">為什麼會需要Multi Project Template</h2><p>一般來說當我們程式比較大一點的時候，我們都會把他們分層。最常見就是分3層：   </p><ol><li>DB層</li><li>邏輯層</li><li>顯示層</li></ol><p>有時候為了好區分，我們可能會把這三層各自建立一個project - 所以假設今天我建立一個新的project直接就建立出3個Project，是不是就會引導大家把對應內容放到對應的Project，來達到關注點分離。   </p><p>因此，Multi Project的範本也非常的有幫助。   </p></section><section><h2 id="WizKMOutline_1503939015913400">建立Multi Project的情境</h2><p>首先還是要先建立出未來新增的時候要建立的內容。   </p><p>所以先建立出一個新的solution，然後把<code>Process</code>和<code>Model</code>的CS檔案放到另外一個邏輯層的專案。   </p><div class="bs-callout bs-callout-info">實際的程式碼可以參考：<a href="https://github.com/alantsai-samples/mhat-visualstudio-template/tree/sample/chapter05/src/MultiProjectTemplate">github 上面 MultiProjectTemplate</a></div><figure><a href="https://lh3.googleusercontent.com/-Tuv-pVxulLI/WaRMptL0H4I/AAAAAAAAWNE/nBqrh7Jw4tkeFPWm81_EtHRMz2BY9xOHACHMYCw/s1600-h/image%255B5%255D"><img width="452" height="441" title="multi project最後看起來的樣子" style="display: inline; background-image: none;" alt="multi project最後看起來的樣子" src="/posts/migrate/2017-08-29-buildYourOwnTemplate-create-multi-project-template_Asset/image_thumb[1](25).png" border="0" class="img-responsive"></a><br><figcaption>multi project最後看起來的樣子</figcaption></figure></section><section><h2 id="WizKMOutline_1503939015913990">建立Multi Project Template</h2><p>整個建立的流程如下：   </p><ol><li>先把兩個project用匯出的方式匯出Project Template</li><li>建立出multi project template的資料夾結構</li><li>整個打包zip</li><li>放到對應路徑</li></ol><section><h3 id="WizKMOutline_1503939015913235">1 先把兩個project用匯出的方式匯出Project Template</h3><p>用在第三篇（<a href="http://blog.alantsai.net/2017/08/buildYourOwnTemplate-create-VS-template-using-export.html">[03]透過匯出建立Project Template</a>）學到的方式，把兩個專案分別匯出。    </p><p>最後會得到兩個zip檔案。    </p><figure><a href="https://lh3.googleusercontent.com/-RhI77NNMhxU/WaRMrs6lDWI/AAAAAAAAWNM/X1Oc0b8zLdQ5N6F2EGMwBsn1UjuVa7wrwCHMYCw/s1600-h/image%255B8%255D"><img width="654" height="130" title="匯出的zip檔案" style="display: inline; background-image: none;" alt="匯出的zip檔案" src="/posts/migrate/2017-08-29-buildYourOwnTemplate-create-multi-project-template_Asset/image_thumb[2](19).png" border="0" class="img-responsive"></a><br><figcaption>匯出的zip檔案</figcaption></figure></section><section><h3 id="WizKMOutline_1503939015913682">2 建立出multi project template的資料夾結構</h3><p>基本上Multi Project和單一project差不多，唯一的差異在於在根會有個<code>vstemplate</code>檔案，會指向要建立兩個project的<code>vstemplate</code>。    </p><p>所以先把兩個zip檔案解壓縮出來，然後在根的資料夾建立一個<code>root.vstemplate</code>的檔案    </p><pre class="brush: plain;"><code class="language-none line-numbers">Multi Project
|--MHAT.MultiConsole.Bll
  |--MyTemplate.vstemplate
|--MHAT.MultiConsole.ConsoleApp
  |--MyTemplate.vstemplate
|--root.vstemplate</code></pre><p><code>root.vstemplate</code>內容則是：    </p><pre class="brush: xml;highlight:[1,18,21]"><code class="language-markup line-numbers"><vstemplate xmlns="http://schemas.microsoft.com/developer/vstemplate/2005" type="ProjectGroup" version="3.0.0">
  <templatedata>
    <name>MHAT.ProcessTemplate.ConsoleApp.Multi</name>
    <description>&lt;No description available&gt;</description>
    <projecttype>CSharp</projecttype>
    <projectsubtype>
    </projectsubtype>
    <sortorder>1000</sortorder>
    <createnewfolder>true</createnewfolder>
    <defaultname>ConsoleApp1</defaultname>
    <providedefaultname>true</providedefaultname>
    <locationfield>Enabled</locationfield>
    <enablelocationbrowsebutton>true</enablelocationbrowsebutton>
    <icon>__TemplateIcon.ico</icon>
  </templatedata>
  <templatecontent>
    <projectcollection>  
        <projecttemplatelink projectname="$safeprojectname$.ConsoleApp">  
            MHAT.MultiConsole.ConsoleApp\MyTemplate.vstemplate  
        </projecttemplatelink>  
        <projecttemplatelink projectname="$safeprojectname$.Bll">  
            MHAT.MultiConsole.Bll\MyTemplate.vstemplate  
        </projecttemplatelink>  
    </projectcollection> 
  </templatecontent>
</vstemplate></code></pre><p>這個<code>root.vstemplate</code>有幾個地方注意一下： </p><dl><dt><code>VSTemplate</code>的<code>Type="ProjectGroup"</code></dt><dd>   之前Project Template是<code>Type="Project"</code>，而multi project則是<code>ProjectGroup</code>。  </dd><dd></dd><dt><code>TemplateContent</code>內容不同  </dt><dd>   變成是一個<code>ProjectCollection</code>，裡面會包含每一個multi project要包含的<code>vstemplate</code>的位置，這邊可以注意到<code>ProjectName</code>則是可以定義建立出來的專案名稱。   透過使用<code>Parameter</code>可以讓名稱一致。  </dd><dd></dd><dt><code>Projecttemplatelink</code>的順序很重要  </dt><dd>   放在第一個的會作為預設的<em>起始專案</em>。  </dd><dd></dd></dl><figure><a href="https://lh3.googleusercontent.com/-DPZcI4DuAkI/WaRMtTKpsjI/AAAAAAAAWNU/6Lkh5zbZaS0zNn3BJsedQmjLjAG__rfVQCHMYCw/s1600-h/image%255B11%255D"><img width="654" height="173" title="最後的專案結構" style="display: inline; background-image: none;" alt="最後的專案結構" src="/posts/migrate/2017-08-29-buildYourOwnTemplate-create-multi-project-template_Asset/image_thumb[3](16).png" border="0" class="img-responsive"></a><br><figcaption>最後的專案結構</figcaption></figure></section><section><h3 id="WizKMOutline_1503939015913464">3 整個打包zip</h3><p>確認好之後，可以直接把它zip起來，變成multi project template的內容。    </p></section><section><h3 id="WizKMOutline_1503939015913354">4 放到對應路徑</h3><p>基本上在Document下面的VS的Project Template下面，然後如果要放到某個分類裡面建立對應資料夾。    </p><div class="bs-callout bs-callout-info"><ul><li>      這篇有<a href="http://blog.alantsai.net/2017/08/buildYourOwnTemplate-create-VS-template-using-export.html#WizKMOutline_1503805714768815">[03]透過匯出建立Project Template</a>詳細介紹路徑要放哪裡      </li><li>       這篇有<a href="http://blog.alantsai.net/2017/08/buildYourOwnTemplate-understand-vstemplate-make-vs-refresh-template-cache.html#WizKMOutline_1503822127931924">[04]了解vstemplate來微調匯出的Template和強制VS更新Template的方式</a>介紹分類的資訊。      </li></ul>，         </div></section></section><section><h2 id="WizKMOutline_1503939015913225">測試最後結果</h2><p>放好之後就可以開VS然後測試建立Multi Project。   </p><div class="bs-callout bs-callout-info">如果VS template找不到，可以試試看清理cache，詳細參考<a href="http://blog.alantsai.net/2017/08/buildYourOwnTemplate-understand-vstemplate-make-vs-refresh-template-cache.html#WizKMOutline_1503822127931725">更新template - 如何讓vs重新刷新</a></div><a href="https://lh3.googleusercontent.com/-l3ihSwwfqwU/WaRMyLXNXJI/AAAAAAAAWNc/WsWSsEKEEVcU_3w-KC8mOfRaEr9R0NRQACHMYCw/s1600-h/image%255B14%255D"><img width="654" height="375" title="建立專案畫面" style="display: inline; background-image: none;" alt="建立專案畫面" src="/posts/migrate/2017-08-29-buildYourOwnTemplate-create-multi-project-template_Asset/image_thumb[4](16).png" border="0" class="img-responsive"></a><figure><a href="https://lh3.googleusercontent.com/-l3tbqyI88HI/WaRM2OUibHI/AAAAAAAAWNk/fDzhWzSFJ18HpdOPm7bjRehzBUIWVIp3ACHMYCw/s1600-h/image%255B17%255D"><img width="365" height="385" title="建立出來的內容" style="display: inline; background-image: none;" alt="建立出來的內容" src="/posts/migrate/2017-08-29-buildYourOwnTemplate-create-multi-project-template_Asset/image_thumb[5](9).png" border="0" class="img-responsive"></a><br><figcaption>建立出multi project 可以看到輸入的專案名稱會有對應到各自專案</figcaption></figure><div class="bs-callout bs-callout-warning">這邊注意到，雖然build起來會先nuget restore，但是因為路徑的關係，所以dll的reference會錯。所以還需要自己手動把資料夾往上提一層就好。因為專案建立出來會自己多包一層，造成層數有錯。這個只能夠透過寫<code>Wizard</code>    來解決。   </div></section><section><h2 id="WizKMOutline_1503939015913264">結語</h2><p>了解了Project Template的細節之後，再回來看Multi Project Template，會發現其實很容易理解，只是需要知道<code>ProjectGroup</code>類型的<code>vstemplate</code>結構即可。   </p><p>基本上Project Template的部分差不多到了一個段落，在下一篇將會對於另外一種Template - Item Template作介紹   </p></section><section><h2 id="WizKMOutline_1503939015913640">參考資料</h2><dl><dt><a href="https://docs.microsoft.com/en-us/visualstudio/ide/how-to-create-multi-project-templates">How to: Create Multi-Project Templates</a></dt><dd>     官方介紹的文件    </dd><dd></dd><dt><a href="https://blog.jayway.com/2015/03/13/visual-studio-how-to-create-a-solution-template-with-multiple-projects/">Visual Studio: How to create a solution template with multiple projects</a></dt><dd>     很不錯介紹建立Multi Project Template的教學    </dd><dd></dd><dt><a href="https://github.com/ligershark/template-builder/pull/79">SideWaffle fix for multi-project template structure</a><br><a href="https://stackoverflow.com/questions/3882764/issue-with-visual-studio-template-directory-creation">Issue with visual studio template &amp; directory creation</a></dt><dd>     提到nuget路徑的問題，需要透過寫Wizard來解決。SideWaffle有個<code>SolutionWizard</code>但是我實際用有錯。    </dd><dd></dd></dl></section>  <section> <div class="wlWriterEditableSmartContent" id="scid:77ECF5F8-D252-44F5-B4EB-D463C5396A79:59b4947b-30a2-463a-be40-4c3fa6c25cc1" style="margin: 0px; padding: 0px; float: none; display: inline;">標籤: <a href="/tags/%e3%80%8c%e6%89%93%e9%80%a0%e8%87%aa%e5%b7%b1%e7%9a%84template-%e5%bb%ba%e7%ab%8b%e4%b8%80%e8%87%b4%e6%80%a7%e7%a8%8b%e5%bc%8f%e7%a2%bc%e3%80%8d" rel="tag">「打造自己的template-建立一致性程式碼」</a>,<a href="/tags/Visual+Studio" rel="tag">Visual Studio</a></div></section>